<!DOCTYPE html>
<html lang="tr">
<head>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#38bdf8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 1447 / 2026 Ramazan ƒ∞msakiyesi</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïå</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');

        /* TEMALAR */
        :root {
            --bg-color: #0f172a; --panel-bg: #1e293b; --text-color: #f8fafc; --text-muted: #94a3b8;
            --border-color: #334155; --accent: #38bdf8; --iftar-color: #10b981; --hover-bg: #475569;
            --table-bg: #1e293b; --table-header-bg: rgba(0, 0, 0, 0.25); --selection-bg: rgba(56, 189, 248, 0.2);
            --header-gradient: linear-gradient(to right, #38bdf8, #f8fafc, #38bdf8);
        }
        [data-theme="sepia"] {
            --bg-color: #f4ecd8; --panel-bg: #fffbf0; --text-color: #4a3c31; --text-muted: #8c7b6b;
            --border-color: #d6caba; --accent: #b45309; --iftar-color: #047857; --hover-bg: #f0e6d2;
            --table-bg: #fffbf0; --table-header-bg: rgba(0, 0, 0, 0.04); --selection-bg: rgba(180, 83, 9, 0.15);
            --header-gradient: linear-gradient(to right, #b45309, #4a3c31, #b45309);
        }
        [data-theme="oled"] { 
            --bg-color: #000; --panel-bg: #111; --text-color: #e0e0e0; --accent: #fbbf24; 
            --table-bg: #111; --selection-bg: rgba(251, 191, 36, 0.2);
            --header-gradient: linear-gradient(to right, #fbbf24, #e0e0e0, #fbbf24); 
        }
        [data-theme="dark-forest"] { 
            --bg-color: #061f14; --panel-bg: #0b2f1f; --text-color: #e2f1e8; --accent: #fcd34d; 
            --table-bg: #0b2f1f; --selection-bg: rgba(252, 211, 77, 0.2);
            --header-gradient: linear-gradient(to right, #fcd34d, #e2f1e8, #fcd34d); 
        }
        [data-theme="light"] { 
            --bg-color: #f1f5f9; --panel-bg: #fff; --text-color: #0f172a; --accent: #2563eb; 
            --table-bg: #fff; --selection-bg: rgba(37, 99, 235, 0.1);
            --header-gradient: linear-gradient(to right, #2563eb, #0f172a, #2563eb); 
        }

        body {
            font-family: 'Outfit', 'Segoe UI', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 15px 20px; min-height: 100vh; display: flex; flex-direction: column;
            align-items: center; box-sizing: border-box; overflow-y: auto; overflow-x: hidden; transition: all 0.3s ease;
        }
        
        .top-header-container { width: 100%; text-align: center; margin-bottom: 20px; position: relative; }
        .top-header {
            font-size: 2.4em; font-weight: 300; letter-spacing: 5px; text-transform: uppercase;
            margin: 0; padding: 10px 0; background: var(--header-gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-size: 200% auto; animation: shine 5s linear infinite;
        }
        .top-header strong { font-weight: 800; }
        @keyframes shine { to { background-position: 200% center; } }
        .header-line { width: 150px; height: 2px; background: var(--accent); margin: 0 auto; border-radius: 2px; opacity: 0.7; position: relative; }
        .header-line::after { content: ''; position: absolute; top: -2px; left: 50%; transform: translateX(-50%); width: 20px; height: 6px; background: var(--bg-color); border: 2px solid var(--accent); border-radius: 50%; }

        .main-wrapper {
            display: grid; grid-template-columns: 360px 1fr; gap: 25px; width: 100%;
            height: calc(100vh - 90px); transition: zoom 0.2s ease;
        }
        
        .panel { background: var(--panel-bg); padding: 15px 20px; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.25); display: flex; flex-direction: column; position: relative; }
        
        .countdown-box { background-color: var(--bg-color); border: 2px solid var(--border-color); border-radius: 12px; padding: 12px; text-align: center; margin-bottom: 12px; position: relative; }
        .moon-phase { position: absolute; top: 10px; right: 10px; font-size: 1.5em; opacity: 0.8; cursor: help;}
        
        .modern-datetime {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--table-header-bg); padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px dashed var(--border-color);
        }
        #liveTime { font-size: 1.8em; font-weight: 800; color: var(--text-color); font-variant-numeric: tabular-nums; line-height: 1; letter-spacing: 2px; }
        #liveDate { font-size: 0.85em; font-weight: 600; color: var(--text-muted); margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        .countdown-title { font-size: 0.9em; font-weight: bold; color: var(--accent); margin-bottom: 5px; text-transform: uppercase; }
        .countdown-timer { font-size: 2.8em; font-weight: bold; letter-spacing: 2px; font-variant-numeric: tabular-nums;}
        .warning-15 { color: #f59e0b !important; animation: pulse-warning 2s infinite; }
        @keyframes pulse-warning { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .progress-wrapper { background: rgba(0,0,0,0.2); border-radius: 8px; height: 8px; overflow: hidden; margin-top: 10px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }
        [data-theme="light"] .progress-wrapper, [data-theme="sepia"] .progress-wrapper { background: rgba(0,0,0,0.08); }
        .progress-bar { background: linear-gradient(90deg, var(--accent), var(--iftar-color)); height: 100%; width: 0%; transition: width 1s linear; border-radius: 8px;}
        .progress-text { font-size: 0.75em; display: block; margin-top: 6px; color: var(--text-muted); font-weight: 600; }

        .today-wrapper { margin-bottom: 5px; }
        .today-wrapper h2 { color: var(--accent); font-size: 1.2em; margin: 0 0 10px 0; text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
        .time-row { display: flex; justify-content: space-between; padding: 7px 10px; border-bottom: 1px dashed var(--border-color); font-size: 1.1em; transition: opacity 0.3s; }
        .time-row.iftar { color: var(--iftar-color); font-weight: bold; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-bottom: none; padding: 10px;}
        .past-time { opacity: 0.35; } 

        .bayram-box { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; border-radius: 12px; background: rgba(16, 185, 129, 0.1); border: 1px dashed var(--iftar-color); margin: 5px 0 10px 0; }
        .bayram-title { font-size: 0.80em; color: var(--text-muted); font-weight: bold; text-transform: uppercase; margin-bottom: 4px; }
        .bayram-date { font-size: 1.05em; color: var(--iftar-color); font-weight: bold; }
        .bayram-time-title { font-size: 0.75em; color: var(--text-muted); font-weight: 600; margin-bottom: 4px; cursor: help;}
        .bayram-time { font-size: 1.6em; font-weight: 900; color: var(--text-color); font-variant-numeric: tabular-nums; line-height: 1;}

        .zikir-box { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; border-radius: 12px; background: var(--bg-color); border: 1px solid var(--border-color); margin: 10px 0 5px 0; }
        .zikir-display { font-size: 1.8em; font-weight: 900; color: var(--accent); width: 60px; text-align: center; font-variant-numeric: tabular-nums; }
        .zikir-btn { flex-grow: 1; margin: 0 15px; padding: 10px; border-radius: 8px; border: none; background: rgba(56, 189, 248, 0.15); color: var(--text-color); font-weight: bold; cursor: pointer; transition: 0.1s; border: 1px solid var(--accent);}
        .zikir-btn:active { transform: scale(0.95); background: var(--accent); color: #000;}
        .zikir-reset { background: transparent; border: none; font-size: 1.2em; color: var(--text-muted); cursor: pointer; transition: 0.2s; }
        .zikir-reset:hover { color: #ef4444; transform: rotate(-180deg); }
        
        .calc-btn-main { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 8px; border: 1px dashed var(--iftar-color); background: rgba(16, 185, 129, 0.1); color: var(--text-color); font-weight: bold; cursor: pointer; transition: 0.2s; }
        .calc-btn-main:hover { background: rgba(16, 185, 129, 0.2); }

        .settings-grid { margin-top: auto; padding-top: 10px; border-top: 1px solid var(--border-color); }
        .old-settings-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 0.75em; font-weight: 600; color: var(--text-muted); margin-bottom: 4px; }
        select, .zoom-controls, .sound-controls { height: 38px; box-sizing: border-box; } 
        select { width: 100%; padding: 0 8px; font-size: 12px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); cursor: pointer; outline: none; }
        .zoom-controls, .sound-controls { display: flex; gap: 4px; width: 100%; }
        .btn-action { flex: 1; height: 100%; font-size: 16px; font-weight: bold; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-action:hover { background-color: var(--hover-bg); }
        .sound-toggle-row { grid-column: span 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: var(--bg-color); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer; font-size: 0.85em; font-weight: 600; margin-top: 5px; height: 38px; box-sizing: border-box;}
        
        .btn-fullscreen-settings { grid-column: span 1; display: flex; align-items: center; justify-content: center; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: 0.2s; margin-top: 5px; height: 38px; box-sizing: border-box;}
        .btn-fullscreen-settings:hover { background: var(--hover-bg); }

        .right-panel { display: flex; flex-direction: column; gap: 15px; height: 100%; }
        .tables-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; flex-grow: 1; height: 100%; min-height: 0; }
        .table-card { border-radius: 16px; overflow: hidden; border: 1px solid var(--border-color); background-color: var(--table-bg); display: flex; flex-direction: column; height: 100%; }
        table { width: 100%; height: 100%; border-collapse: collapse; text-align: center; font-size: clamp(0.7em, 1.3vh, 1em); table-layout: fixed; }
        th, td { padding: 0; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        th { background-color: var(--table-header-bg); color: var(--accent); font-weight: 700; }
        tr { cursor: pointer; transition: background 0.15s; }
        tr:hover { background-color: var(--hover-bg); }
        .today-row { background-color: rgba(16, 185, 129, 0.12) !important; font-weight: bold; border: 1px solid var(--iftar-color); }
        .selected-row { background-color: var(--selection-bg) !important; box-shadow: inset 0 0 0 2px var(--accent) !important; }
        .iftar-col { color: var(--iftar-color); font-weight: 800; }
        .date-hicri { font-weight: 800; }
        .date-miladi { color: var(--text-muted); font-size: 0.9em; }

        /* MODAL STƒ∞LLERƒ∞ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; width: 90%; max-width: 650px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); transform: scale(0.9); transition: transform 0.3s ease; max-height: 90vh; overflow-y: auto;}
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px dashed var(--border-color); padding-bottom: 15px; }
        .modal-header h3 { margin: 0; color: var(--accent); font-size: 1.5em; display: flex; align-items: center; gap: 10px; }
        .modal-close { background: transparent; border: none; color: var(--text-muted); font-size: 1.8em; cursor: pointer; transition: 0.2s; line-height: 1; }
        .modal-close:hover { color: #ef4444; transform: rotate(90deg); }
        
        .modal-times { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 20px; text-align: center; }
        .modal-time-box { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; }
        .modal-time-box.iftar-box { background: rgba(16, 185, 129, 0.1); border-color: var(--iftar-color); color: var(--iftar-color); font-weight: bold; }
        .modal-time-name { font-size: 0.8em; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; text-transform: uppercase;}
        .modal-time-val { font-size: 1.2em; font-weight: bold;}

        .daily-banner-modal { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .banner-card { background: var(--bg-color); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: center;}
        .banner-title { color: var(--accent); font-size: 1.05em; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;}
        .banner-content { font-size: 0.95em; color: var(--text-color); line-height: 1.5; font-style: italic;}
        .banner-source { font-size: 0.8em; color: var(--text-muted); margin-top: 10px; font-weight: 600; text-align: right; }
        .menu-list { display: flex; flex-direction: column; gap: 10px; }
        .menu-item { display: flex; align-items: center; justify-content: flex-start; gap: 10px; font-size: 1em; color: var(--text-color); }
        .menu-icon { opacity: 0.8; font-size: 1.2em; }

        /* TDV ZEKAT VE Fƒ∞TRE ARACI STƒ∞LLERƒ∞ */
        .calc-section { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; }
        .calc-input-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .calc-input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background: var(--panel-bg); color: var(--text-color); font-family: 'Outfit'; font-size: 1em; width: 100%; box-sizing: border-box;}
        .calc-result { font-size: 1.5em; font-weight: bold; color: var(--iftar-color); text-align: right; margin-top: 10px; transition: 0.3s; }

        .tdv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .tdv-input-box { display: flex; flex-direction: column; }
        .tdv-input-box label { font-size: 0.75em; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; }
        .tdv-input-box input { padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--panel-bg); color: var(--text-color); font-family: 'Outfit'; font-size: 0.95em;}
        .tdv-input-box.debt input { border-color: rgba(239, 68, 68, 0.4); color: #ef4444; }
        .tdv-input-box.debt label { color: #ef4444; }
        .tdv-summary { background: var(--table-bg); border: 1px dashed var(--border-color); padding: 12px; border-radius: 8px; }

        @media (max-width: 1300px) { 
            .main-wrapper { grid-template-columns: 320px 1fr; height: auto; }
            .tables-wrapper { grid-template-columns: 1fr; gap: 0; height: auto; border-radius: 16px; border: 1px solid var(--border-color); overflow: hidden; } 
            .table-card { border: none; border-radius: 0; height: auto; }
            #table2 thead { display: none; }
        }
        @media (max-width: 800px) {
            .main-wrapper { grid-template-columns: 1fr; display: flex; flex-direction: column; }
            body { height: auto; overflow: auto; padding: 10px; }
        }
        @media (max-width: 600px) {
            .daily-banner-modal { grid-template-columns: 1fr; }
            .modal-times { grid-template-columns: repeat(3, 1fr); }
            .tdv-grid { grid-template-columns: 1fr; } 
            table { font-size: 0.85em; } 
        }
        @media (max-height: 650px) {
            body { height: auto !important; min-height: 100vh; overflow-y: auto !important; display: block; }
            .main-wrapper { height: auto !important; display: flex !important; flex-direction: column; }
            .tables-wrapper, .right-panel, .table-card { height: auto !important; }
        }
    </style>
</head>
<body data-theme="sepia">

<audio id="sound_bell" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
<audio id="sound_soft" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sound_modern" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>
<audio id="sound_ding" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
<audio id="sound_beep" src="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3"></audio>
<audio id="sound_chime" src="https://assets.mixkit.co/active_storage/sfx/1052/1052-preview.mp3"></audio>
<audio id="sound_crystal" src="https://assets.mixkit.co/active_storage/sfx/1115/1115-preview.mp3"></audio>
<audio id="sound_piano" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>
<audio id="sound_echo" src="https://assets.mixkit.co/active_storage/sfx/2607/2607-preview.mp3"></audio>
<audio id="sound_retro" src="https://assets.mixkit.co/active_storage/sfx/1931/1931-preview.mp3"></audio>
<audio id="sound_warning" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>

<div class="top-header-container">
    <h1 class="top-header">üåô 1447 / 2026 <strong>Ramazan</strong> ƒ∞msakiyesi</h1>
    <div class="header-line"></div>
</div>

<div class="main-wrapper" id="mainWrapper">
    
    <div class="panel left-panel">
        <div class="countdown-box" id="cbox">
            <div id="moon" class="moon-phase" title="Bug√ºnk√º Ay Evresi">üåë</div>
            
            <div class="modern-datetime">
                <div id="liveTime">00:00:00</div>
                <div id="liveDate">Y√ºkleniyor...</div>
            </div>

            <div class="countdown-title" id="mainCountdownTitle">Y√ºkleniyor...</div>
            <div class="countdown-timer" id="mainCountdownTimer">00:00:00</div>
            
            <div id="subCountdownContainer" style="display: none; margin-top: 15px; padding-top: 10px; border-top: 1px dashed var(--border-color);">
                <div class="countdown-title" id="subCountdownTitle" style="font-size: 0.85em; color: var(--text-muted); margin-bottom: 2px;">Sƒ±radaki Vakit</div>
                <div class="countdown-timer" id="subCountdownTimer" style="font-size: 1.6em; color: var(--text-color);">00:00:00</div>
            </div>

            <div id="progressContainer" style="display: none;">
                <div class="progress-wrapper"><div class="progress-bar" id="progressBar"></div></div>
                <span class="progress-text" id="progressText">Oru√ß ƒ∞lerlemesi: %0</span>
            </div>
        </div>

        <div class="today-wrapper">
            <h2 id="selectedDayTitle">üóìÔ∏è Bug√ºn√ºn Vakit Saatleri</h2>
            <div class="today-times" id="todayTimesContainer"></div>
        </div>

        <div class="bayram-box" id="bayramBox">
            <div>
                <div class="bayram-title">üéâ Ramazan Bayramƒ± (1. G√ºn)</div>
                <div class="bayram-date">20 Mart 2026 Cuma</div>
            </div>
            <div style="text-align: right;">
                <div class="bayram-time-title" title="Diyanet usul√ºne g√∂re ≈üehrin G√ºne≈ü doƒüumundan ortalama 45 dk sonrasƒ± baz alƒ±narak dinamik hesaplanmƒ±≈ütƒ±r.">Tahmini Namaz Vakti*</div>
                <div class="bayram-time" id="bayramTime">--:--</div>
            </div>
        </div>

        <div class="zikir-box">
            <button class="zikir-reset" onclick="resetZikir()" title="Sƒ±fƒ±rla">‚Ü∫</button>
            <div class="zikir-display" id="zikirDisplay">0</div>
            <button class="zikir-btn" onclick="addZikir()">üìø Zikir √áek</button>
        </div>
        
        <button class="calc-btn-main" onclick="openCalcModal()">üí∞ Fitre & Zek√¢t Hesapla</button>

        <div class="settings-grid">
            <div class="old-settings-layout">
                <div><label>üìç ≈ûehir</label><select id="citySelect" onchange="getMonthlyTimings(); saveSettings();"></select></div>
                <div>
                    <label>üé® Tema</label>
                    <select id="themeSelect" onchange="changeTheme(); saveSettings();">
                        <optgroup label="üåë KOYULAR"><option value="dark">Gece Mavisi</option><option value="oled">K√∂m√ºr Siyahƒ±</option><option value="dark-forest">Koyu Orman</option></optgroup>
                        <optgroup label="‚òÄÔ∏è A√áIKLAR"><option value="sepia" selected>Sepya (Krem)</option><option value="light">Klasik Beyaz</option></optgroup>
                    </select>
                </div>
                <div>
                    <label>üîç Zoom</label>
                    <div class="zoom-controls">
                        <button class="btn-action" onclick="changeZoom(-0.02)">-</button>
                        <button class="btn-action" onclick="changeZoom(0.02)">+</button>
                    </div>
                </div>
                <div>
                    <label>üîî Ses Se√ßimi</label>
                    <div class="sound-controls">
                        <select id="soundSelect" onchange="saveSettings();" style="flex:2.5;">
                            <option value="sound_bell">Klasik Zil</option><option value="sound_soft">Yumu≈üak √áan</option><option value="sound_modern">Modern Uyarƒ±</option>
                            <option value="sound_ding">Ding-Dong</option><option value="sound_beep">Dijital Beep</option><option value="sound_chime">R√ºzgar √áanƒ±</option>
                            <option value="sound_crystal">Kristal Tƒ±nlama</option><option value="sound_piano">Soft Piyano</option><option value="sound_echo">Eko Uyarƒ±</option>
                            <option value="sound_retro">Retro Oyun</option>
                        </select>
                        <button class="btn-action" onclick="testSound()" title="Sesi Dinle" style="flex:1;">‚ñ∂Ô∏è</button>
                    </div>
                </div>
                <button class="btn-fullscreen-settings" onclick="toggleFullScreen()" id="fsBtn">üî≤ Tam Ekran</button>
                
                <button class="btn-fullscreen-settings" onclick="requestNotificationPermission()" style="color: var(--accent); border-color: var(--accent);">üì± Bildirim ƒ∞zni</button>
                
                <button id="installAppBtn" class="btn-fullscreen-settings" style="display: none; background: var(--iftar-color); color: white; border-color: var(--iftar-color); grid-column: span 2;">üì± Uygulamayƒ± Y√ºkle</button>
                <label class="sound-toggle-row"><input type="checkbox" id="soundToggle" onchange="saveSettings();" checked> Bildirim Sesi</label>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="tables-wrapper" id="tablesWrapper">
            <div class="table-card"><table id="table1"><thead><tr><th>Hicri (1447)</th><th>Miladi (2026)</th><th>ƒ∞msak</th><th>G√ºne≈ü</th><th>√ñƒüle</th><th>ƒ∞kindi</th><th class="iftar-col">ƒ∞ftar</th><th>Yatsƒ±</th></tr></thead><tbody id="tbody1"></tbody></table></div>
            <div class="table-card"><table id="table2"><thead><tr><th>Hicri (1447)</th><th>Miladi (2026)</th><th>ƒ∞msak</th><th>G√ºne≈ü</th><th>√ñƒüle</th><th>ƒ∞kindi</th><th class="iftar-col">ƒ∞ftar</th><th>Yatsƒ±</th></tr></thead><tbody id="tbody2"></tbody></table></div>
        </div>
    </div>
</div>

<div id="dailyModal" class="modal-overlay" onclick="closeModal(event, 'dailyModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3 id="modalTitle">üåü 1 Ramazan √ñzel ƒ∞√ßerikleri</h3>
            <button class="modal-close" onclick="closeModal(null, 'dailyModal')">√ó</button>
        </div>

        <div class="modal-times" id="modalTimesContainer"></div>
        
        <div class="daily-banner-modal">
            <div class="banner-card">
                <div class="banner-title">üç≤ ƒ∞ftar Men√ºs√º √ñnerisi</div>
                <div class="menu-list">
                    <div class="menu-item"><span class="menu-icon">ü•£</span><span id="menuSoup">...</span></div>
                    <div class="menu-item"><span class="menu-icon">ü•ò</span><span id="menuMain">...</span></div>
                    <div class="menu-item"><span class="menu-icon">üç∞</span><span id="menuDessert">...</span></div>
                </div>
            </div>
            <div class="banner-card">
                <div class="banner-title">üìñ G√ºn√ºn S√∂z√º</div>
                <div class="banner-content" id="dailyQuote">...</div>
                <div class="banner-source" id="dailySource">...</div>
            </div>
        </div>
    </div>
</div>

<div id="calcModal" class="modal-overlay" onclick="closeModal(event, 'calcModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3>üí∞ Fitre & Zek√¢t Hesaplama</h3>
            <button class="modal-close" onclick="closeModal(null, 'calcModal')">√ó</button>
        </div>

        <div class="calc-section">
            <div class="banner-title">üåæ Fitre Hesaplama</div>
            <p style="font-size: 0.85em; color: var(--text-muted); margin-bottom: 10px;">Diyanet tahmini bedelini (240 ‚Ç∫) veya kendi belirlediƒüiniz tutarƒ± girebilirsiniz.</p>
            <div class="calc-input-group">
                <input type="number" id="fitreAmount" class="calc-input" value="240" placeholder="Ki≈üi ba≈üƒ± tutar (‚Ç∫)" oninput="calculateFitre()">
                <span style="color: var(--text-muted); font-weight: bold;">X</span>
                <input type="number" id="fitrePerson" class="calc-input" placeholder="Ki≈üi Sayƒ±sƒ±" min="1" oninput="calculateFitre()">
            </div>
            <div class="calc-result" id="fitreResult">0 ‚Ç∫</div>
        </div>

        <div class="calc-section">
            <div class="banner-title" style="margin-bottom: 5px;">ü•á TDV Usul√º Zek√¢t Hesaplama</div>
            <p style="font-size: 0.80em; color: var(--text-muted); margin-bottom: 15px; line-height: 1.4;">
                <a href="https://zekathesapla.tdv.org" target="_blank" style="color: var(--accent); text-decoration: none;">zekathesapla.tdv.org</a> standartlarƒ±na g√∂re Nakit, D√∂viz, Altƒ±n ve Ticari varlƒ±klarƒ±nƒ±zƒ± kalem kalem hesaplayƒ±n.
            </p>
            
            <div style="background: rgba(0,0,0,0.1); padding: 12px; border-radius: 8px; margin-bottom: 15px; border: 1px solid var(--border-color);">
                <div class="calc-input-group" style="margin-bottom: 0;">
                    <label style="width: 150px; font-size: 0.85em; font-weight: bold;">Gram Altƒ±n Fiyatƒ± (‚Ç∫): <br><span id="goldLiveIndicator" style="font-size: 0.85em; color: var(--text-muted); font-weight: normal;">(Bekleniyor...)</span></label>
                    <input type="number" id="tdvGoldPrice" class="calc-input" value="3000" oninput="calcTDVZekat()">
                </div>
                <div style="font-size: 0.80em; color: var(--accent); text-align: right; margin-top: 8px; font-weight: bold;" id="tdvNisapInfo">Nisap Sƒ±nƒ±rƒ± (80.18 gr): -- ‚Ç∫</div>
            </div>

            <div class="tdv-grid">
                <div class="tdv-input-box">
                    <label>Nakit Para (‚Ç∫)</label>
                    <input type="number" id="tdvCash" placeholder="0" oninput="calcTDVZekat()">
                </div>
                <div class="tdv-input-box">
                    <label>D√∂viz Toplamƒ± (‚Ç∫ Kar≈üƒ±lƒ±ƒüƒ±)</label>
                    <input type="number" id="tdvCurrency" placeholder="0" oninput="calcTDVZekat()">
                </div>
                <div class="tdv-input-box">
                    <label>Altƒ±n Miktarƒ± (Gram)</label>
                    <input type="number" id="tdvGoldGrams" placeholder="0" oninput="calcTDVZekat()">
                </div>
                <div class="tdv-input-box">
                    <label>Ticari Mal / Hisse (‚Ç∫)</label>
                    <input type="number" id="tdvTrade" placeholder="0" oninput="calcTDVZekat()">
                </div>
                <div class="tdv-input-box">
                    <label>Alacaklar (‚Ç∫)</label>
                    <input type="number" id="tdvReceivables" placeholder="0" oninput="calcTDVZekat()">
                </div>
                <div class="tdv-input-box debt">
                    <label>Bor√ßlar (-) (‚Ç∫)</label>
                    <input type="number" id="tdvDebts" placeholder="0" oninput="calcTDVZekat()">
                </div>
            </div>
            
            <div class="tdv-summary">
                <div style="display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 5px; color: var(--text-muted); font-weight: 600;">
                    <span>Safi (Net) Varlƒ±k:</span> <span id="tdvNetWealth">0 ‚Ç∫</span>
                </div>
                <div class="calc-result" id="tdvZekatResult">0 ‚Ç∫</div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentZoom = 0.95;
    let allEvents = [];
    let countdownInterval;
    let warningPlayed = false;
    let zikirCount = 0;
    window.isTodayView = true; 
    let isInitialLoad = true;

    const moonPhases = ["üåë","üåí","üåí","üåì","üåì","üåî","üåî","üåï","üåï","üåñ","üåñ","üåó","üåó","üåò","üåò","üåë"];

    const ramadanContent = [
        { soup: "S√ºzme Mercimek √áorbasƒ±", main: "Fƒ±rƒ±nda Tavuk Patates", dessert: "G√ºlla√ß", quote: "Oru√ß, cehennem ate≈üinden koruyan bir kalkandƒ±r.", source: "Buh√¢r√Æ, Savm 2" },
        { soup: "Ezogelin √áorbasƒ±", main: "Karnƒ±yarƒ±k & Pirin√ß Pilavƒ±", dessert: "S√ºtla√ß", quote: "Kim inanarak ve sevabƒ±nƒ± umarak Ramazan orucunu tutarsa ge√ßmi≈ü g√ºnahlarƒ± affolunur.", source: "Buh√¢r√Æ, √ém√¢n 28" },
        { soup: "Yayla √áorbasƒ±", main: "Orman Kebabƒ±", dessert: "Revani", quote: "Oru√ßlunun rahatlamasƒ± i√ßin iki sevin√ß anƒ± vardƒ±r: Biri iftar ettiƒüi zaman, diƒüeri de Rabbine kavu≈ütuƒüu zamandƒ±r.", source: "M√ºslim, Sƒ±y√¢m 163" },
        { soup: "Tarhana √áorbasƒ±", main: "ƒ∞zmir K√∂fte", dessert: "Kemalpa≈üa Tatlƒ±sƒ±", quote: "Sahur yemeƒüi yiyin, zira sahurda bereket vardƒ±r.", source: "Buh√¢r√Æ, Savm 20" },
        { soup: "Domates √áorbasƒ±", main: "Tas Kebabƒ±", dessert: "Kadayƒ±f", quote: "Oru√ßlu iken √ßirkin s√∂z s√∂ylemeyin ve kimseyle √ßeki≈ümeyin.", source: "Buh√¢r√Æ, Savm 9" },
        { soup: "Mantar √áorbasƒ±", main: "H√ºnk√¢r Beƒüendi", dessert: "≈ûekerpare", quote: "Cennette Reyy√¢n denilen bir kapƒ± vardƒ±r ki, kƒ±yamet g√ºn√º oradan ancak oru√ßlular girecektir.", source: "Buh√¢r√Æ, Savm 4" },
        { soup: "D√ºƒü√ºn √áorbasƒ±", main: "Etli Kuru Fasulye", dessert: "Supangle", quote: "Ramazan ayƒ± girdiƒüinde cennet kapƒ±larƒ± a√ßƒ±lƒ±r, cehennem kapƒ±larƒ± kapanƒ±r ve ≈üeytanlar baƒülanƒ±r.", source: "Buh√¢r√Æ, Savm 5" },
        { soup: "≈ûehriye √áorbasƒ±", main: "Tavuk Sote", dessert: "Trile√ße", quote: "ƒ∞nsanlarƒ±n en hayƒ±rlƒ±sƒ±, insanlara faydalƒ± olandƒ±r.", source: "Hadis-i ≈ûerif" },
        { soup: "Brokoli √áorbasƒ±", main: "Fƒ±rƒ±n Somon", dessert: "Profiterol", quote: "Kolayla≈ütƒ±rƒ±n, zorla≈ütƒ±rmayƒ±n; m√ºjdeleyin, nefret ettirmeyin.", source: "Buh√¢r√Æ, ƒ∞lim 11" },
        { soup: "Tavuk Suyu √áorbasƒ±", main: "Alinazik", dessert: "Tavukg√∂ƒüs√º", quote: "Veren el, alan elden √ºst√ºnd√ºr.", source: "M√ºslim, Zek√¢t 94" },
        { soup: "Kelle Pa√ßa √áorbasƒ±", main: "Kavurma & ≈ûehriyeli Pilav", dessert: "Baklava", quote: "M√ºsl√ºmanƒ±n M√ºsl√ºmana tebess√ºm etmesi sadakadƒ±r.", source: "Tirmizi, Birr 36" },
        { soup: "Ayran A≈üƒ± √áorbasƒ±", main: "Zeytinyaƒülƒ± Taze Fasulye", dessert: "Kazandibi", quote: "Kim bir oru√ßluya iftar ettirirse, oru√ßlunun sevabƒ± kadar sevap kazanƒ±r.", source: "Tirmizi, Savm 82" },
        { soup: "Mahluta √áorbasƒ±", main: "Patlƒ±can Musakka", dessert: "Cevizli Sarma", quote: "Sadaka, Rabbinin √∂fkesini s√∂nd√ºr√ºr ve k√∂t√º √∂l√ºm√º bertaraf eder.", source: "Tirmizi, Zek√¢t 28" },
        { soup: "Lebeniye √áorbasƒ±", main: "Kaƒüƒ±t Kebabƒ±", dessert: "ƒ∞rmik Helvasƒ±", quote: "Sizin en hayƒ±rlƒ±nƒ±z, Kur'an'ƒ± √∂ƒürenen ve √∂ƒüretendir.", source: "Buh√¢r√Æ, Fez√¢il√º'l-Kur'√¢n 21" },
        { soup: "Kremalƒ± Mantar √áorbasƒ±", main: "Fƒ±rƒ±n Makarna", dessert: "Kƒ±brƒ±s Tatlƒ±sƒ±", quote: "G√ºzel s√∂z sadakadƒ±r.", source: "Buh√¢r√Æ, Edeb 34" },
        { soup: "Yuvalama √áorbasƒ±", main: "Kayseri Tava", dessert: "Lokma Tatlƒ±sƒ±", quote: "Allah, merhametli olanlara merhamet eder.", source: "Eb√ª D√¢v√ªd, Edeb 58" },
        { soup: "Tutma√ß √áorbasƒ±", main: "Tavuklu Mantar Sote", dessert: "Fƒ±rƒ±n S√ºtla√ß", quote: "Amellerin en hayƒ±rlƒ±sƒ±, az da olsa devamlƒ± olanƒ±dƒ±r.", source: "M√ºslim, M√ºs√¢fir√Æn 218" },
        { soup: "K√∂zlenmi≈ü Domates √áorbasƒ±", main: "Hasanpa≈üa K√∂fte", dessert: "≈û√∂biyet", quote: "Bir kimse karde≈üinin ihtiyacƒ±nƒ± giderirse, Allah da onun ihtiyacƒ±nƒ± giderir.", source: "Buh√¢r√Æ, Mez√¢lim 3" },
        { soup: "Sebze √áorbasƒ±", main: "Tepsi Kebabƒ±", dessert: "K√ºnefe", quote: "Sabƒ±r, imanƒ±n yarƒ±sƒ±dƒ±r.", source: "Hadis-i ≈ûerif" },
        { soup: "≈ûafak √áorbasƒ±", main: "Etli Nohut", dessert: "Muhallebi", quote: "Hi√ßbiriniz kendi nefsi i√ßin istediƒüini karde≈üi i√ßin de istemedik√ße tam m√ºmin olamaz.", source: "Buh√¢r√Æ, √ém√¢n 7" },
        { soup: "Ispanak √áorbasƒ±", main: "Zeytinyaƒülƒ± Barbunya", dessert: "Zerde", quote: "Oru√ß, sabrƒ±n yarƒ±sƒ±dƒ±r.", source: "ƒ∞bn M√¢ce, Sƒ±y√¢m 44" },
        { soup: "Eri≈üte √áorbasƒ±", main: "Tavuk ≈ûi≈ü", dessert: "Magnolia", quote: "ƒ∞ki nimet vardƒ±r ki, insanlarƒ±n √ßoƒüu bunlarƒ±n kƒ±ymetini bilmez: Saƒülƒ±k ve bo≈ü vakit.", source: "Buh√¢r√Æ, Rik√¢k 1" },
        { soup: "Kabak √áorbasƒ±", main: "K√∂fteli Patates Dizme", dessert: "Vi≈üneli Turta", quote: "Dua, ibadetin √∂z√ºd√ºr.", source: "Tirmizi, Daav√¢t 1" },
        { soup: "Soƒüan √áorbasƒ±", main: "√á√∂kertme Kebabƒ±", dessert: "Soƒüuk Baklava", quote: "≈û√ºphesiz Allah, affedicidir ve affetmeyi sever.", source: "Tirmizi, Daav√¢t 84" },
        { soup: "Mƒ±sƒ±r √áorbasƒ±", main: "G√ºve√ßte Et", dessert: "Krem Karamel", quote: "Kadir Gecesi'ni, faziletine inanarak ve sevabƒ±nƒ± umarak ihya edenin ge√ßmi≈ü g√ºnahlarƒ± baƒüƒ±≈ülanƒ±r.", source: "Buh√¢r√Æ, Kadir 1" },
        { soup: "Bamya √áorbasƒ±", main: "Misket K√∂fteli Bezelye", dessert: "ƒ∞ncir Uyutmasƒ±", quote: "Kim Allah'a ve ahiret g√ºn√ºne inanƒ±yorsa kom≈üusuna iyilik etsin.", source: "M√ºslim, √ém√¢n 74" },
        { soup: "Tavuklu ≈ûehriye √áorbasƒ±", main: "≈ûehzade Kebabƒ±", dessert: "Kelek Tatlƒ±sƒ±", quote: "Ger√ßek zenginlik mal √ßokluƒüu deƒüil, g√∂n√ºl tokluƒüudur.", source: "Buh√¢r√Æ, Rik√¢k 15" },
        { soup: "Semizotu √áorbasƒ±", main: "Eli B√∂ƒür√ºnde", dessert: "B√ºlb√ºl Yuvasƒ±", quote: "ƒ∞≈ü√ßiye √ºcretini teri kurumadan veriniz.", source: "ƒ∞bn M√¢ce, R√ºh√ªn 4" },
        { soup: "S√ºtl√º Kabak √áorbasƒ±", main: "Fƒ±rƒ±n Pili√ß", dessert: "Saray Sarmasƒ±", quote: "Bayram, g√ºnahlarƒ±n baƒüƒ±≈ülandƒ±ƒüƒ± g√ºnd√ºr.", source: "Hz. Ali (r.a.)" },
        { soup: "Kƒ±rmƒ±zƒ± Mercimek √áorbasƒ±", main: "Karƒ±≈üƒ±k Izgara", dessert: "Geleneksel G√ºlla√ß", quote: "Ramazan'ƒ±n sonu cehennemden azad olmaktƒ±r.", source: "ƒ∞bn Huzeyme" }
    ];

    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(e => console.log(e));
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
        }
    }

    document.addEventListener('fullscreenchange', () => {
        const fsBtn = document.getElementById('fsBtn');
        if (document.fullscreenElement) {
            fsBtn.innerHTML = "üî≥ √áƒ±kƒ±≈ü Yap";
        } else {
            fsBtn.innerHTML = "üî≤ Tam Ekran";
        }
    });

    // CANLI ALTIN KURU √áEKME FONKSƒ∞YONU
    async function fetchLiveGoldPrice() {
        const indicator = document.getElementById('goldLiveIndicator');
        indicator.innerText = "(G√ºncel Kur √áekiliyor...)";
        indicator.style.color = "var(--accent)";
        
        try {
            const response = await fetch('https://api.genelpara.com/embed/altin.json');
            const data = await response.json();
            
            if (data && data.GA && data.GA.satis) {
                // Gelen veriyi float'a √ßevirip 2 ondalƒ±klƒ± hale getiriyoruz
                const livePrice = parseFloat(data.GA.satis);
                document.getElementById('tdvGoldPrice').value = livePrice.toFixed(2);
                
                indicator.innerText = "(Canlƒ± Kur üü¢)";
                indicator.style.color = "var(--iftar-color)";
            } else {
                throw new Error("Veri formatƒ± tanƒ±nmadƒ±");
            }
        } catch (error) {
            console.log("Canlƒ± altƒ±n fiyatƒ± √ßekilemedi, manuel deƒüer beklenecek:", error);
            indicator.innerText = "(Manuel Giriniz üî¥)";
            indicator.style.color = "#ef4444";
        }
        
        calcTDVZekat(); // Kur deƒüi≈ütiƒüi i√ßin veya hata alƒ±ndƒ±ƒüƒ± i√ßin hesabƒ± yenile
    }

    // MODAL Y√ñNETƒ∞Mƒ∞
    function openModal() { document.getElementById('dailyModal').classList.add('active'); }
    function openCalcModal() { 
        document.getElementById('calcModal').classList.add('active'); 
        calculateFitre();
        fetchLiveGoldPrice(); // Zekat penceresi a√ßƒ±ldƒ±ƒüƒ±nda canlƒ± kuru √ßekmeye ba≈üla
    }
    function closeModal(event, modalId) {
        if(event && event.target !== document.getElementById(modalId) && event.target.className !== 'modal-close') return;
        document.getElementById(modalId).classList.remove('active');
    }

    // Fƒ∞TRE HESAPLAMA
    function calculateFitre() {
        const amount = parseFloat(document.getElementById('fitreAmount').value) || 0;
        const person = parseInt(document.getElementById('fitrePerson').value) || 0;
        document.getElementById('fitreResult').innerText = (amount * person).toLocaleString('tr-TR') + " ‚Ç∫";
    }

    // TDV ZEK√ÇT HESAPLAMA
    function calcTDVZekat() {
        const goldPrice = parseFloat(document.getElementById('tdvGoldPrice').value) || 0;
        
        const cash = parseFloat(document.getElementById('tdvCash').value) || 0;
        const currency = parseFloat(document.getElementById('tdvCurrency').value) || 0;
        const goldGrams = parseFloat(document.getElementById('tdvGoldGrams').value) || 0;
        const trade = parseFloat(document.getElementById('tdvTrade').value) || 0;
        const receivables = parseFloat(document.getElementById('tdvReceivables').value) || 0;
        const debts = parseFloat(document.getElementById('tdvDebts').value) || 0;

        // Nisap Miktarƒ± (80.18 Gram Altƒ±n)
        const nisapThreshold = 80.18 * goldPrice;
        document.getElementById('tdvNisapInfo').innerText = `Nisap Sƒ±nƒ±rƒ± (80.18 gr): ${nisapThreshold.toLocaleString('tr-TR', { maximumFractionDigits: 0 })} ‚Ç∫`;

        // Br√ºt ve Net Varlƒ±k
        const goldValue = goldGrams * goldPrice;
        const totalWealth = cash + currency + goldValue + trade + receivables;
        const netWealth = totalWealth - debts;

        document.getElementById('tdvNetWealth').innerText = netWealth.toLocaleString('tr-TR', { maximumFractionDigits: 0 }) + " ‚Ç∫";
        const resultEl = document.getElementById('tdvZekatResult');

        // ≈ûartlarƒ±n Deƒüerlendirilmesi
        if (netWealth >= nisapThreshold && nisapThreshold > 0) {
            const zekat = netWealth / 40; // 1/40 yani %2.5
            resultEl.style.color = "var(--iftar-color)";
            resultEl.style.fontSize = "1.5em";
            resultEl.innerText = "Verilecek Zek√¢t: " + zekat.toLocaleString('tr-TR', { maximumFractionDigits: 2 }) + " ‚Ç∫";
        } else {
            resultEl.style.color = "var(--text-muted)";
            resultEl.style.fontSize = "1em";
            if (netWealth > 0) {
                resultEl.innerText = "Safi varlƒ±ƒüƒ±nƒ±z nisap sƒ±nƒ±rƒ±nƒ±n altƒ±ndadƒ±r.";
            } else {
                resultEl.innerText = "0 ‚Ç∫";
            }
        }
    }

    // Zƒ∞Kƒ∞R FONKSƒ∞YONLARI
    function loadZikir() {
        zikirCount = parseInt(localStorage.getItem('imsakiye_zikir')) || 0;
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }
    function addZikir() {
        zikirCount++;
        localStorage.setItem('imsakiye_zikir', zikirCount);
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }
    function resetZikir() {
        zikirCount = 0;
        localStorage.setItem('imsakiye_zikir', zikirCount);
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }

    // Bƒ∞LDƒ∞Rƒ∞M ƒ∞ZNƒ∞ VE G√ñNDERƒ∞Mƒ∞
    function requestNotificationPermission() {
        if (!("Notification" in window)) {
            alert("Tarayƒ±cƒ±nƒ±z masa√ºst√º bildirimlerini desteklemiyor.");
        } else if (Notification.permission === "granted") {
            alert("Bildirim izni zaten verilmi≈ü! Vakit girdiƒüinde ekranƒ±nƒ±za bildirim gelecek.");
        } else if (Notification.permission !== "denied") {
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    alert("Bildirim izni ba≈üarƒ±yla alƒ±ndƒ±!");
                }
            });
        }
    }

    function sendPushNotification(title, body) {
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification(title, { body: body, icon: "data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïå</text></svg>" });
        }
    }

    function saveSettings() {
        const settings = {
            city: document.getElementById('citySelect').value,
            theme: document.getElementById('themeSelect').value,
            zoom: currentZoom,
            sound: document.getElementById('soundSelect').value,
            soundActive: document.getElementById('soundToggle').checked
        };
        localStorage.setItem('imsakiye_settings', JSON.stringify(settings));
    }

    function loadSettings() {
        const saved = localStorage.getItem('imsakiye_settings');
        if (saved) {
            const s = JSON.parse(saved);
            document.getElementById('citySelect').value = s.city || "Rize";
            document.getElementById('themeSelect').value = s.theme || "sepia";
            currentZoom = s.zoom || 0.95;
            document.getElementById('soundSelect').value = s.sound || "sound_bell";
            document.getElementById('soundToggle').checked = s.soundActive !== undefined ? s.soundActive : true;
        } else {
            document.getElementById('citySelect').value = "Rize";
            document.getElementById('themeSelect').value = "sepia";
        }
        changeTheme();
        document.getElementById('mainWrapper').style.zoom = currentZoom;
    }

    function changeZoom(s){ currentZoom+=s; document.getElementById('mainWrapper').style.zoom = currentZoom; saveSettings(); }
    function changeTheme(){ document.body.setAttribute('data-theme', document.getElementById('themeSelect').value); }
    
    function testSound() {
        const audio = document.getElementById(document.getElementById('soundSelect').value);
        if(audio) { audio.currentTime = 0; audio.play().catch(e => console.log("Etkile≈üim gerekli")); }
    }

    const cities = ["Adana", "Adiyaman", "Afyonkarahisar", "Agri", "Aksaray", "Amasya", "Ankara", "Antalya", "Ardahan", "Artvin", "Aydin", "Balikesir", "Bartin", "Batman", "Bayburt", "Bilecik", "Bingol", "Bitlis", "Bolu", "Burdur", "Bursa", "Canakkale", "Cankiri", "Corum", "Denizli", "Diyarbakir", "Duzce", "Edirne", "Elazig", "Erzincan", "Erzurum", "Eskisehir", "Gaziantep", "Giresun", "Gumushane", "Hakkari", "Hatay", "Igdir", "Isparta", "Istanbul", "Izmir", "Kahramanmaras", "Karabuk", "Karaman", "Kars", "Kastamonu", "Kayseri", "Kilis", "Kirikkale", "Kirklareli", "Kirsehir", "Kocaeli", "Konya", "Kutahya", "Malatya", "Manisa", "Mardin", "Mersin", "Mugla", "Mus", "Nevsehir", "Nigde", "Ordu", "Osmaniye", "Rize", "Sakarya", "Samsun", "Sanliurfa", "Siirt", "Sinop", "Sirnak", "Sivas", "Tekirdag", "Tokat", "Trabzon", "Tunceli", "Usak", "Van", "Yalova", "Yozgat", "Zonguldak"];
    const citySelect = document.getElementById('citySelect');
    cities.forEach(c => { let o = document.createElement('option'); o.value = c; o.textContent = c; citySelect.appendChild(o); });

    function updateMoonPhase(hDay) {
        let phaseIndex = Math.floor((hDay / 29) * (moonPhases.length - 1));
        if(phaseIndex < 0) phaseIndex = 0; if(phaseIndex >= moonPhases.length) phaseIndex = moonPhases.length - 1;
        document.getElementById('moon').innerText = moonPhases[phaseIndex];
    }

    function updateDailyContent(hDay) {
        let index = hDay - 1;
        if(index < 0) index = 0;
        if(index >= ramadanContent.length) index = ramadanContent.length - 1;
        
        const data = ramadanContent[index];
        document.getElementById('modalTitle').innerHTML = `üåü ${hDay} Ramazan √ñzel ƒ∞√ßerikleri`;
        document.getElementById('menuSoup').innerText = data.soup;
        document.getElementById('menuMain').innerText = data.main;
        document.getElementById('menuDessert').innerText = data.dessert;
        document.getElementById('dailyQuote').innerText = `"${data.quote}"`;
        document.getElementById('dailySource').innerText = `- ${data.source}`;
    }

    function selectDay(el, h, im, gu, og, ik, ak, ya, isToday=false) {
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('selected-row'));
        if(el) el.classList.add('selected-row');
        
        window.isTodayView = isToday;
        document.getElementById('selectedDayTitle').innerText = isToday ? "üóìÔ∏è Bug√ºn√ºn Vakit Saatleri" : `üóìÔ∏è ${h} Ramazan Vakit Saatleri`;
        
        updateMoonPhase(h);
        updateDailyContent(h);

        document.getElementById('todayTimesContainer').innerHTML = `
            <div class="time-row" data-time="${im}"><span>ƒ∞msak</span><span>${im}</span></div>
            <div class="time-row" data-time="${gu}"><span>G√ºne≈ü</span><span>${gu}</span></div>
            <div class="time-row" data-time="${og}"><span>√ñƒüle</span><span>${og}</span></div>
            <div class="time-row" data-time="${ik}"><span>ƒ∞kindi</span><span>${ik}</span></div>
            <div class="time-row iftar" data-time="${ak}"><span>ƒ∞ftar (Ak≈üam)</span><span>${ak}</span></div>
            <div class="time-row" data-time="${ya}"><span>Yatsƒ±</span><span>${ya}</span></div>
        `;

        document.getElementById('modalTimesContainer').innerHTML = `
            <div class="modal-time-box"><div class="modal-time-name">ƒ∞msak</div><div class="modal-time-val">${im}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">G√ºne≈ü</div><div class="modal-time-val">${gu}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">√ñƒüle</div><div class="modal-time-val">${og}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">ƒ∞kindi</div><div class="modal-time-val">${ik}</div></div>
            <div class="modal-time-box iftar-box"><div class="modal-time-name">ƒ∞ftar</div><div class="modal-time-val">${ak}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">Yatsƒ±</div><div class="modal-time-val">${ya}</div></div>
        `;
        
        if(!isInitialLoad) {
            openModal();
        }
    }

    async function getMonthlyTimings() {
        const city = citySelect.value;
        const tbody1 = document.getElementById('tbody1'); const tbody2 = document.getElementById('tbody2');
        tbody1.innerHTML = ''; tbody2.innerHTML = ''; allEvents = [];
        
        // √áEVRƒ∞MDI≈ûI √ñNBELLEK KONTROL√ú
        const cacheKey = `imsakiye_2026_${city}`;
        const cachedData = localStorage.getItem(cacheKey);
        let dF, dM;

        try {
            if (cachedData) {
                const parsed = JSON.parse(cachedData);
                dF = parsed.dF;
                dM = parsed.dM;
                console.log("Veri √∂nbellekten (√ßevrimdƒ±≈üƒ±) y√ºklendi.");
            } else {
                const [rF, rM] = await Promise.all([
                    fetch(`https://api.aladhan.com/v1/calendarByCity/2026/2?city=${city}&country=Turkey&method=13`),
                    fetch(`https://api.aladhan.com/v1/calendarByCity/2026/3?city=${city}&country=Turkey&method=13`)
                ]);
                dF = await rF.json(); 
                dM = await rM.json();
                localStorage.setItem(cacheKey, JSON.stringify({dF: dF, dM: dM}));
                console.log("Veri API'den √ßekildi ve kaydedildi.");
            }

            const bayramDay = dM.data.find(day => day.date.gregorian.date === "20-03-2026");
            if (bayramDay) {
                const sunriseStr = bayramDay.timings.Sunrise.split(' ')[0];
                const [h, m] = sunriseStr.split(':').map(Number);
                let bayramD = new Date();
                bayramD.setHours(h, m + 45, 0, 0); 
                
                const bayramH = String(bayramD.getHours()).padStart(2, '0');
                const bayramM = String(bayramD.getMinutes()).padStart(2, '0');
                document.getElementById('bayramTime').innerText = `${bayramH}:${bayramM}`;
            }

            const ramadanDays = [...dF.data, ...dM.data].filter(day => {
                const [d, m, y] = day.date.gregorian.date.split('-');
                const cur = new Date(`${y}-${m}-${d}`);
                return cur >= new Date('2026-02-19') && cur <= new Date('2026-03-19');
            });

            const todayStr = String(new Date().getDate()).padStart(2, '0') + '-' + String(new Date().getMonth() + 1).padStart(2, '0') + '-' + new Date().getFullYear();
            const mid = Math.ceil(ramadanDays.length / 2);
            let todayRef = null; let todayObj = null;

            ramadanDays.forEach((day, i) => {
                const t = day.timings; const gDate = day.date.gregorian.date; const hDay = i + 1;
                const clean = (s) => s.split(' ')[0];
                const v = { im: clean(t.Imsak), gu: clean(t.Sunrise), og: clean(t.Dhuhr), ik: clean(t.Asr), ak: clean(t.Maghrib), ya: clean(t.Isha) };
                const [d, m, y] = gDate.split('-');
                const makeD = (ts) => new Date(`${y}-${m}-${d}T${ts}:00`);
                
                allEvents.push(
                    { n: 'ƒ∞msak', t: makeD(v.im), isFast: true },
                    { n: 'G√ºne≈ü', t: makeD(v.gu), isFast: false },
                    { n: '√ñƒüle', t: makeD(v.og), isFast: false },
                    { n: 'ƒ∞kindi', t: makeD(v.ik), isFast: false },
                    { n: 'ƒ∞ftar', t: makeD(v.ak), isFast: true, isI: true },
                    { n: 'Yatsƒ±', t: makeD(v.ya), isFast: false }
                );

                const isT = (gDate === todayStr);
                const row = document.createElement('tr');
                if(isT) row.className = 'today-row';
                
                row.onclick = () => selectDay(row, hDay, v.im, v.gu, v.og, v.ik, v.ak, v.ya, isT);
                row.innerHTML = `<td class="date-hicri">${hDay} Ramazan</td><td class="date-miladi">${d} ${["Oca","≈ûub","Mar","Nis","May","Haz","Tem","Aƒüu","Eyl","Eki","Kas","Ara"][m-1]}</td><td>${v.im}</td><td>${v.gu}</td><td>${v.og}</td><td>${v.ik}</td><td class="iftar-col">${v.ak}</td><td>${v.ya}</td>`;
                
                if(i < mid) tbody1.appendChild(row); else tbody2.appendChild(row);
                if(isT) { todayRef = row; todayObj = { hDay, ...v }; }
            });

            if(todayRef) todayRef.click();
            else if(ramadanDays.length > 0) tbody1.firstChild.click();
            
            isInitialLoad = false;
            startCountdown();

        } catch (e) { 
            console.log("Veri y√ºklenirken hata olu≈ütu:", e); 
            if(!cachedData) alert("L√ºtfen verilerin ilk kez y√ºklenmesi i√ßin internet baƒülantƒ±nƒ±zƒ± kontrol edin.");
        }
    }

   function startCountdown() {
        allEvents.sort((a,b) => a.t - b.t);
        clearInterval(countdownInterval);
        
        countdownInterval = setInterval(() => {
            const now = new Date(); 
            const futureEvents = allEvents.filter(e => e.t > now);
            const next = futureEvents[0]; 
            const nextFast = futureEvents.find(e => e.isFast); 
            
            if(nextFast) {
                const diffFast = nextFast.t - now;
                const hF = Math.floor(diffFast / 3600000); 
                const mF = Math.floor((diffFast % 3600000) / 60000); 
                const sF = Math.floor((diffFast % 60000) / 1000);
                const pad = (n) => String(n).padStart(2, '0');
                
                document.getElementById('mainCountdownTitle').innerText = `${nextFast.n} Vaktine Kalan`;
                document.getElementById('mainCountdownTimer').innerText = `${pad(hF)}:${pad(mF)}:${pad(sF)}`;
                document.getElementById('mainCountdownTitle').style.color = nextFast.isI ? 'var(--iftar-color)' : 'var(--accent)';
            }

            if (next) {
                const diffNext = next.t - now;
                const hN = Math.floor(diffNext / 3600000); 
                const mN = Math.floor((diffNext % 3600000) / 60000); 
                const sN = Math.floor((diffNext % 60000) / 1000);
                const pad = (n) => String(n).padStart(2, '0');

                if (nextFast && next.n !== nextFast.n) {
                    document.getElementById('subCountdownContainer').style.display = 'block';
                    document.getElementById('subCountdownTitle').innerText = `Sƒ±radaki Vakit (${next.n})`;
                    document.getElementById('subCountdownTimer').innerText = `${pad(hN)}:${pad(mN)}:${pad(sN)}`;
                } else {
                    document.getElementById('subCountdownContainer').style.display = 'none';
                }

                if (diffNext <= 900000) { 
                    if (nextFast && next.n === nextFast.n) {
                        document.getElementById('mainCountdownTimer').classList.add('warning-15');
                        document.getElementById('subCountdownTimer').classList.remove('warning-15');
                    } else {
                        document.getElementById('subCountdownTimer').classList.add('warning-15');
                        document.getElementById('mainCountdownTimer').classList.remove('warning-15');
                    }

                    if (mN === 15 && sN === 0 && !warningPlayed && document.getElementById('soundToggle').checked) {
                        document.getElementById('sound_warning').play().catch(e => console.log("Ses engellendi:", e));
                        warningPlayed = true;
                    }
                } else {
                    document.getElementById('mainCountdownTimer').classList.remove('warning-15');
                    document.getElementById('subCountdownTimer').classList.remove('warning-15');
                    warningPlayed = false; 
                }

                if(hN === 0 && mN === 0 && sN === 0) {
                    if (document.getElementById('soundToggle').checked) {
                        const selectedSound = document.getElementById('soundSelect').value;
                        document.getElementById(selectedSound).play().catch(e => console.log("Ses oynatma engellendi:", e));
                    }
                    sendPushNotification(`üîî ${next.n} Vakti!`, `${document.getElementById('citySelect').value} i√ßin ${next.n} vakti girdi. Hayƒ±rlƒ± Ramazanlar!`);
                }
            }

            if (window.isTodayView) {
                document.querySelectorAll('#todayTimesContainer .time-row').forEach(row => {
                    const timeStr = row.getAttribute('data-time');
                    if(timeStr) {
                        const [hr, mn] = timeStr.split(':');
                        const rowTime = new Date();
                        rowTime.setHours(hr, mn, 0, 0);
                        if (now >= rowTime) row.classList.add('past-time');
                        else row.classList.remove('past-time');
                    }
                });
            } else {
                document.querySelectorAll('#todayTimesContainer .time-row').forEach(r => r.classList.remove('past-time'));
            }

            const pastEvents = allEvents.filter(e => e.t <= now);
            let nextIftar = futureEvents.find(e => e.isI === true);
            let prevImsak = pastEvents.slice().reverse().find(e => e.n === 'ƒ∞msak');

            if (nextIftar && prevImsak && nextIftar.t.getDate() === prevImsak.t.getDate()) {
                let totalTime = nextIftar.t - prevImsak.t;
                let elapsedTime = now - prevImsak.t;
                let percentage = (elapsedTime / totalTime) * 100;
                
                document.getElementById('progressContainer').style.display = 'block';
                document.getElementById('progressBar').style.width = percentage + '%';
                document.getElementById('progressText').innerText = `Oru√ß ƒ∞lerlemesi: %${percentage.toFixed(1)}`;
            } else {
                document.getElementById('progressContainer').style.display = 'none';
            }

        }, 1000);
    }

    function updateLiveDateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('liveTime').innerText = `${hours}:${minutes}:${seconds}`;
        
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('liveDate').innerText = now.toLocaleDateString('tr-TR', options) + " (Miladi)";
    }

   window.onload = () => {
        loadSettings();
        loadZikir();
        getMonthlyTimings();
        
        updateLiveDateTime();
        setInterval(updateLiveDateTime, 1000);
    };

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('PWA Service Worker ba≈üarƒ±yla kaydedildi.', reg))
                .catch(err => console.log('PWA Service Worker hatasƒ±:', err));
        });
    }

    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installAppBtn').style.display = 'block';
    });

    document.getElementById('installAppBtn').addEventListener('click', async () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                console.log('Kullanƒ±cƒ± uygulamayƒ± y√ºkledi.');
                document.getElementById('installAppBtn').style.display = 'none';
            }
            deferredPrompt = null;
        }
    });
</script>
</body>
</html>