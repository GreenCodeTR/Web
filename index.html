<!DOCTYPE html>
<html lang="tr">
<head>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#38bdf8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 1447 / 2026 Ramazan Ä°msakiyesi</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ•Œ</text></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap');

        /* TEMALAR */
        :root {
            --bg-color: #0f172a; --panel-bg: #1e293b; --text-color: #f8fafc; --text-muted: #94a3b8;
            --border-color: #334155; --accent: #38bdf8; --iftar-color: #10b981; --hover-bg: #475569;
            --table-bg: #1e293b; --table-header-bg: rgba(0, 0, 0, 0.25); --selection-bg: rgba(56, 189, 248, 0.2);
            --header-gradient: linear-gradient(to right, #38bdf8, #f8fafc, #38bdf8);
        }
        [data-theme="sepia"] {
            --bg-color: #f4ecd8; --panel-bg: #fffbf0; --text-color: #4a3c31; --text-muted: #8c7b6b;
            --border-color: #d6caba; --accent: #b45309; --iftar-color: #047857; --hover-bg: #f0e6d2;
            --table-bg: #fffbf0; --table-header-bg: rgba(0, 0, 0, 0.04); --selection-bg: rgba(180, 83, 9, 0.15);
            --header-gradient: linear-gradient(to right, #b45309, #4a3c31, #b45309);
        }
        [data-theme="oled"] { 
            --bg-color: #000; --panel-bg: #111; --text-color: #e0e0e0; --accent: #fbbf24; 
            --table-bg: #111; --selection-bg: rgba(251, 191, 36, 0.2);
            --header-gradient: linear-gradient(to right, #fbbf24, #e0e0e0, #fbbf24); 
        }
        [data-theme="dark-forest"] { 
            --bg-color: #061f14; --panel-bg: #0b2f1f; --text-color: #e2f1e8; --accent: #fcd34d; 
            --table-bg: #0b2f1f; --selection-bg: rgba(252, 211, 77, 0.2);
            --header-gradient: linear-gradient(to right, #fcd34d, #e2f1e8, #fcd34d); 
        }
        [data-theme="light"] { 
            --bg-color: #f1f5f9; --panel-bg: #fff; --text-color: #0f172a; --accent: #2563eb; 
            --table-bg: #fff; --selection-bg: rgba(37, 99, 235, 0.1);
            --header-gradient: linear-gradient(to right, #2563eb, #0f172a, #2563eb); 
        }

        body {
            font-family: 'Outfit', 'Segoe UI', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: 15px 20px; min-height: 100vh; display: flex; flex-direction: column;
            align-items: center; box-sizing: border-box; overflow-y: auto; overflow-x: hidden; transition: all 0.3s ease;
        }
        
        .top-header-container { width: 100%; text-align: center; margin-bottom: 20px; position: relative; }
        .top-header {
            font-size: 2.4em; font-weight: 300; letter-spacing: 5px; text-transform: uppercase;
            margin: 0; padding: 10px 0; background: var(--header-gradient);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-size: 200% auto; animation: shine 5s linear infinite;
        }
        .top-header strong { font-weight: 800; }
        @keyframes shine { to { background-position: 200% center; } }
        .header-line { width: 150px; height: 2px; background: var(--accent); margin: 0 auto; border-radius: 2px; opacity: 0.7; position: relative; }
        .header-line::after { content: ''; position: absolute; top: -2px; left: 50%; transform: translateX(-50%); width: 20px; height: 6px; background: var(--bg-color); border: 2px solid var(--accent); border-radius: 50%; }

        .main-wrapper {
            display: grid; grid-template-columns: 360px 1fr; gap: 25px; width: 100%;
            height: calc(100vh - 90px); transition: zoom 0.2s ease;
        }
        
        .panel { background: var(--panel-bg); padding: 15px 20px; border-radius: 16px; box-shadow: 0 8px 25px rgba(0,0,0,0.25); display: flex; flex-direction: column; position: relative; }
        
        .countdown-box { background-color: var(--bg-color); border: 2px solid var(--border-color); border-radius: 12px; padding: 12px; text-align: center; margin-bottom: 12px; position: relative; }
        .moon-phase { position: absolute; top: 10px; right: 10px; font-size: 1.5em; opacity: 0.8; cursor: help;}
        
        .modern-datetime {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--table-header-bg); padding: 10px; border-radius: 10px; margin-bottom: 10px; border: 1px dashed var(--border-color);
        }
        #liveTime { font-size: 1.8em; font-weight: 800; color: var(--text-color); font-variant-numeric: tabular-nums; line-height: 1; letter-spacing: 2px; }
        #liveDate { font-size: 0.85em; font-weight: 600; color: var(--text-muted); margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        .countdown-title { font-size: 0.9em; font-weight: bold; color: var(--accent); margin-bottom: 5px; text-transform: uppercase; }
        .countdown-timer { font-size: 2.8em; font-weight: bold; letter-spacing: 2px; font-variant-numeric: tabular-nums;}
        .warning-15 { color: #f59e0b !important; animation: pulse-warning 2s infinite; }
        @keyframes pulse-warning { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        .progress-wrapper { background: rgba(0,0,0,0.2); border-radius: 8px; height: 8px; overflow: hidden; margin-top: 10px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }
        [data-theme="light"] .progress-wrapper, [data-theme="sepia"] .progress-wrapper { background: rgba(0,0,0,0.08); }
        .progress-bar { background: linear-gradient(90deg, var(--accent), var(--iftar-color)); height: 100%; width: 0%; transition: width 1s linear; border-radius: 8px;}
        .progress-text { font-size: 0.75em; display: block; margin-top: 6px; color: var(--text-muted); font-weight: 600; }

        .today-wrapper { margin-bottom: 5px; }
        .today-wrapper h2 { color: var(--accent); font-size: 1.2em; margin: 0 0 10px 0; text-align: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
        .time-row { display: flex; justify-content: space-between; padding: 7px 10px; border-bottom: 1px dashed var(--border-color); font-size: 1.1em; transition: opacity 0.3s; }
        .time-row.iftar { color: var(--iftar-color); font-weight: bold; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-bottom: none; padding: 10px;}
        .past-time { opacity: 0.35; } 

        .zikir-box { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; border-radius: 12px; background: var(--bg-color); border: 1px solid var(--border-color); margin: 10px 0; }
        .zikir-display { font-size: 1.8em; font-weight: 900; color: var(--accent); width: 60px; text-align: center; font-variant-numeric: tabular-nums; }
        .zikir-btn { flex-grow: 1; margin: 0 15px; padding: 10px; border-radius: 8px; border: none; background: rgba(56, 189, 248, 0.15); color: var(--text-color); font-weight: bold; cursor: pointer; transition: 0.1s; border: 1px solid var(--accent);}
        .zikir-btn:active { transform: scale(0.95); background: var(--accent); color: #000;}
        .zikir-reset { background: transparent; border: none; font-size: 1.2em; color: var(--text-muted); cursor: pointer; transition: 0.2s; }
        .zikir-reset:hover { color: #ef4444; transform: rotate(-180deg); }

        .settings-grid { margin-top: auto; padding-top: 10px; border-top: 1px solid var(--border-color); }
        .old-settings-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 0.75em; font-weight: 600; color: var(--text-muted); margin-bottom: 4px; }
        select, .zoom-controls, .sound-controls { height: 38px; box-sizing: border-box; } 
        select { width: 100%; padding: 0 8px; font-size: 12px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); cursor: pointer; outline: none; }
        .zoom-controls, .sound-controls { display: flex; gap: 4px; width: 100%; }
        .btn-action { flex: 1; height: 100%; font-size: 16px; font-weight: bold; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-action:hover { background-color: var(--hover-bg); }
        .sound-toggle-row { grid-column: span 1; display: flex; align-items: center; justify-content: center; gap: 8px; background: var(--bg-color); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); cursor: pointer; font-size: 0.85em; font-weight: 600; margin-top: 5px; height: 38px; box-sizing: border-box;}
        
        .btn-fullscreen-settings { grid-column: span 1; display: flex; align-items: center; justify-content: center; background: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 8px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: 0.2s; margin-top: 5px; height: 38px; box-sizing: border-box;}
        .btn-fullscreen-settings:hover { background: var(--hover-bg); }

        .right-panel { display: flex; flex-direction: column; gap: 15px; height: 100%; }
        .tables-wrapper { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; flex-grow: 1; height: 100%; min-height: 0; }
        .table-card { border-radius: 16px; overflow: hidden; border: 1px solid var(--border-color); background-color: var(--table-bg); display: flex; flex-direction: column; height: 100%; }
        table { width: 100%; height: 100%; border-collapse: collapse; text-align: center; font-size: clamp(0.7em, 1.3vh, 1em); table-layout: fixed; }
        th, td { padding: 0; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        th { background-color: var(--table-header-bg); color: var(--accent); font-weight: 700; }
        tr { cursor: pointer; transition: background 0.15s; }
        tr:hover { background-color: var(--hover-bg); }
        .today-row { background-color: rgba(16, 185, 129, 0.12) !important; font-weight: bold; border: 1px solid var(--iftar-color); }
        .selected-row { background-color: var(--selection-bg) !important; box-shadow: inset 0 0 0 2px var(--accent) !important; }
        .iftar-col { color: var(--iftar-color); font-weight: 800; }
        .date-hicri { font-weight: 800; }
        .date-miladi { color: var(--text-muted); font-size: 0.9em; }

        /* MODAL (AÃ‡ILIR PENCERE) STÄ°LLERÄ° */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: var(--panel-bg); border: 1px solid var(--border-color);
            border-radius: 16px; padding: 25px; width: 90%; max-width: 650px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px dashed var(--border-color); padding-bottom: 15px; }
        .modal-header h3 { margin: 0; color: var(--accent); font-size: 1.5em; display: flex; align-items: center; gap: 10px; }
        .modal-close { background: transparent; border: none; color: var(--text-muted); font-size: 1.8em; cursor: pointer; transition: 0.2s; line-height: 1; }
        .modal-close:hover { color: #ef4444; transform: rotate(90deg); }
        
        .modal-times {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 20px; text-align: center;
        }
        .modal-time-box { background: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; }
        .modal-time-box.iftar-box { background: rgba(16, 185, 129, 0.1); border-color: var(--iftar-color); color: var(--iftar-color); font-weight: bold; }
        .modal-time-name { font-size: 0.8em; color: var(--text-muted); margin-bottom: 4px; font-weight: 600; text-transform: uppercase;}
        .modal-time-val { font-size: 1.2em; font-weight: bold;}

        .daily-banner-modal { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .banner-card { background: var(--bg-color); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; flex-direction: column; justify-content: center;}
        .banner-title { color: var(--accent); font-size: 1.05em; font-weight: bold; margin-bottom: 12px; display: flex; align-items: center; gap: 6px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px;}
        .banner-content { font-size: 0.95em; color: var(--text-color); line-height: 1.5; font-style: italic;}
        .banner-source { font-size: 0.8em; color: var(--text-muted); margin-top: 10px; font-weight: 600; text-align: right; }
        
        .menu-list { display: flex; flex-direction: column; gap: 10px; }
        .menu-item { display: flex; align-items: center; justify-content: flex-start; gap: 10px; font-size: 1em; color: var(--text-color); }
        .menu-icon { opacity: 0.8; font-size: 1.2em; }

        /* EKRAN KÃœÃ‡ÃœLDÃœÄÃœNDE (TABLET VE MOBÄ°L) YAPILACAKLAR */
        @media (max-width: 1300px) { 
            .main-wrapper { grid-template-columns: 320px 1fr; height: auto; }
            
            /* DÄ±ÅŸ Ã§erÃ§eveyi tek bir kutu gibi yapÄ±yoruz */
            .tables-wrapper { 
                grid-template-columns: 1fr; 
                gap: 0; 
                height: auto; 
                border-radius: 16px; 
                border: 1px solid var(--border-color);
                overflow: hidden;
            } 
            
            /* Ä°Ã§erideki kartlarÄ±n kendi sÄ±nÄ±rlarÄ±nÄ± kaldÄ±rÄ±yoruz ki birleÅŸsinler */
            .table-card { 
                border: none; 
                border-radius: 0; 
                height: auto; 
            }
            
            /* Ä°kinci tablonun baÅŸlÄ±ÄŸÄ±nÄ± gizliyoruz ki liste kesilmeden devam etsin */
            #table2 thead { 
                display: none; 
            }
        }

        /* TAM MOBÄ°L GÃ–RÃœNÃœM (TELEFONLAR) */
        @media (max-width: 800px) {
            .main-wrapper { grid-template-columns: 1fr; display: flex; flex-direction: column; }
            body { height: auto; overflow: auto; padding: 10px; }
        }

        @media (max-width: 600px) {
            .daily-banner-modal { grid-template-columns: 1fr; }
            .modal-times { grid-template-columns: repeat(3, 1fr); }
            /* Telefondaki yazÄ± boyutlarÄ±nÄ± biraz daha okunaklÄ± yapalÄ±m */
            table { font-size: 0.85em; } 
        }
    </style>
</head>
<body data-theme="sepia">

<audio id="sound_bell" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
<audio id="sound_soft" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sound_modern" src="https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3"></audio>
<audio id="sound_ding" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
<audio id="sound_beep" src="https://assets.mixkit.co/active_storage/sfx/951/951-preview.mp3"></audio>
<audio id="sound_chime" src="https://assets.mixkit.co/active_storage/sfx/1052/1052-preview.mp3"></audio>
<audio id="sound_crystal" src="https://assets.mixkit.co/active_storage/sfx/1115/1115-preview.mp3"></audio>
<audio id="sound_piano" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>
<audio id="sound_echo" src="https://assets.mixkit.co/active_storage/sfx/2607/2607-preview.mp3"></audio>
<audio id="sound_retro" src="https://assets.mixkit.co/active_storage/sfx/1931/1931-preview.mp3"></audio>
<audio id="sound_warning" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>

<div class="top-header-container">
    <h1 class="top-header">ğŸŒ™ 1447 / 2026 <strong>Ramazan</strong> Ä°msakiyesi</h1>
    <div class="header-line"></div>
</div>

<div class="main-wrapper" id="mainWrapper">
    
    <div class="panel left-panel">
        <div class="countdown-box" id="cbox">
            <div id="moon" class="moon-phase" title="BugÃ¼nkÃ¼ Ay Evresi">ğŸŒ‘</div>
            
            <div class="modern-datetime">
                <div id="liveTime">00:00:00</div>
                <div id="liveDate">YÃ¼kleniyor...</div>
            </div>

            <div class="countdown-title" id="mainCountdownTitle">YÃ¼kleniyor...</div>
            <div class="countdown-timer" id="mainCountdownTimer">00:00:00</div>
            
            <div id="subCountdownContainer" style="display: none; margin-top: 15px; padding-top: 10px; border-top: 1px dashed var(--border-color);">
                <div class="countdown-title" id="subCountdownTitle" style="font-size: 0.85em; color: var(--text-muted); margin-bottom: 2px;">SÄ±radaki Vakit</div>
                <div class="countdown-timer" id="subCountdownTimer" style="font-size: 1.6em; color: var(--text-color);">00:00:00</div>
            </div>

            <div id="progressContainer" style="display: none;">
                <div class="progress-wrapper"><div class="progress-bar" id="progressBar"></div></div>
                <span class="progress-text" id="progressText">OruÃ§ Ä°lerlemesi: %0</span>
            </div>
        </div>

        <div class="today-wrapper">
            <h2 id="selectedDayTitle">ğŸ—“ï¸ BugÃ¼nÃ¼n Vakit Saatleri</h2>
            <div class="today-times" id="todayTimesContainer"></div>
        </div>

        <div class="zikir-box">
            <button class="zikir-reset" onclick="resetZikir()" title="SÄ±fÄ±rla">â†º</button>
            <div class="zikir-display" id="zikirDisplay">0</div>
            <button class="zikir-btn" onclick="addZikir()">ğŸ“¿ Zikir Ã‡ek</button>
        </div>

        <div class="settings-grid">
            <div class="old-settings-layout">
                <div><label>ğŸ“ Åehir</label><select id="citySelect" onchange="getMonthlyTimings(); saveSettings();"></select></div>
                <div>
                    <label>ğŸ¨ Tema</label>
                    <select id="themeSelect" onchange="changeTheme(); saveSettings();">
                        <optgroup label="ğŸŒ‘ KOYULAR"><option value="dark">Gece Mavisi</option><option value="oled">KÃ¶mÃ¼r SiyahÄ±</option><option value="dark-forest">Koyu Orman</option></optgroup>
                        <optgroup label="â˜€ï¸ AÃ‡IKLAR"><option value="sepia" selected>Sepya (Krem)</option><option value="light">Klasik Beyaz</option></optgroup>
                    </select>
                </div>
                <div>
                    <label>ğŸ” Zoom</label>
                    <div class="zoom-controls">
                        <button class="btn-action" onclick="changeZoom(-0.02)">-</button>
                        <button class="btn-action" onclick="changeZoom(0.02)">+</button>
                    </div>
                </div>
                <div>
                    <label>ğŸ”” Ses SeÃ§imi</label>
                    <div class="sound-controls">
                        <select id="soundSelect" onchange="saveSettings();" style="flex:2.5;">
                            <option value="sound_bell">Klasik Zil</option><option value="sound_soft">YumuÅŸak Ã‡an</option><option value="sound_modern">Modern UyarÄ±</option>
                            <option value="sound_ding">Ding-Dong</option><option value="sound_beep">Dijital Beep</option><option value="sound_chime">RÃ¼zgar Ã‡anÄ±</option>
                            <option value="sound_crystal">Kristal TÄ±nlama</option><option value="sound_piano">Soft Piyano</option><option value="sound_echo">Eko UyarÄ±</option>
                            <option value="sound_retro">Retro Oyun</option>
                        </select>
                        <button class="btn-action" onclick="testSound()" title="Sesi Dinle" style="flex:1;">â–¶ï¸</button>
                    </div>
                </div>
                <button class="btn-fullscreen-settings" onclick="toggleFullScreen()" id="fsBtn">ğŸ”² Tam Ekran</button>
                <button id="installAppBtn" class="btn-fullscreen-settings" style="display: none; background: var(--iftar-color); color: white; border-color: var(--iftar-color);">ğŸ“±       UygulamayÄ± YÃ¼kle</button>
                <label class="sound-toggle-row"><input type="checkbox" id="soundToggle" onchange="saveSettings();" checked> Bildirim Sesi</label>
            </div>
        </div>
    </div>

    <div class="right-panel">
        <div class="tables-wrapper" id="tablesWrapper">
            <div class="table-card"><table id="table1"><thead><tr><th>Hicri (1447)</th><th>Miladi (2026)</th><th>Ä°msak</th><th>GÃ¼neÅŸ</th><th>Ã–ÄŸle</th><th>Ä°kindi</th><th class="iftar-col">Ä°ftar</th><th>YatsÄ±</th></tr></thead><tbody id="tbody1"></tbody></table></div>
            <div class="table-card"><table id="table2"><thead><tr><th>Hicri (1447)</th><th>Miladi (2026)</th><th>Ä°msak</th><th>GÃ¼neÅŸ</th><th>Ã–ÄŸle</th><th>Ä°kindi</th><th class="iftar-col">Ä°ftar</th><th>YatsÄ±</th></tr></thead><tbody id="tbody2"></tbody></table></div>
        </div>
    </div>
</div>

<div id="dailyModal" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <h3 id="modalTitle">ğŸŒŸ 1 Ramazan Ã–zel Ä°Ã§erikleri</h3>
            <button class="modal-close" onclick="closeModal()">Ã—</button>
        </div>

        <div class="modal-times" id="modalTimesContainer"></div>
        
        <div class="daily-banner-modal">
            <div class="banner-card">
                <div class="banner-title">ğŸ² Ä°ftar MenÃ¼sÃ¼ Ã–nerisi</div>
                <div class="menu-list">
                    <div class="menu-item"><span class="menu-icon">ğŸ¥£</span><span id="menuSoup">...</span></div>
                    <div class="menu-item"><span class="menu-icon">ğŸ¥˜</span><span id="menuMain">...</span></div>
                    <div class="menu-item"><span class="menu-icon">ğŸ°</span><span id="menuDessert">...</span></div>
                </div>
            </div>
            <div class="banner-card">
                <div class="banner-title">ğŸ“– GÃ¼nÃ¼n SÃ¶zÃ¼</div>
                <div class="banner-content" id="dailyQuote">...</div>
                <div class="banner-source" id="dailySource">...</div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentZoom = 0.95;
    let allEvents = [];
    let countdownInterval;
    let warningPlayed = false;
    let zikirCount = 0;
    window.isTodayView = true; 
    let isInitialLoad = true;

    const moonPhases = ["ğŸŒ‘","ğŸŒ’","ğŸŒ’","ğŸŒ“","ğŸŒ“","ğŸŒ”","ğŸŒ”","ğŸŒ•","ğŸŒ•","ğŸŒ–","ğŸŒ–","ğŸŒ—","ğŸŒ—","ğŸŒ˜","ğŸŒ˜","ğŸŒ‘"];

    const ramadanContent = [
        { soup: "SÃ¼zme Mercimek Ã‡orbasÄ±", main: "FÄ±rÄ±nda Tavuk Patates", dessert: "GÃ¼llaÃ§", quote: "OruÃ§, cehennem ateÅŸinden koruyan bir kalkandÄ±r.", source: "BuhÃ¢rÃ®, Savm 2" },
        { soup: "Ezogelin Ã‡orbasÄ±", main: "KarnÄ±yarÄ±k & PirinÃ§ PilavÄ±", dessert: "SÃ¼tlaÃ§", quote: "Kim inanarak ve sevabÄ±nÄ± umarak Ramazan orucunu tutarsa geÃ§miÅŸ gÃ¼nahlarÄ± affolunur.", source: "BuhÃ¢rÃ®, ÃmÃ¢n 28" },
        { soup: "Yayla Ã‡orbasÄ±", main: "Orman KebabÄ±", dessert: "Revani", quote: "OruÃ§lunun rahatlamasÄ± iÃ§in iki sevinÃ§ anÄ± vardÄ±r: Biri iftar ettiÄŸi zaman, diÄŸeri de Rabbine kavuÅŸtuÄŸu zamandÄ±r.", source: "MÃ¼slim, SÄ±yÃ¢m 163" },
        { soup: "Tarhana Ã‡orbasÄ±", main: "Ä°zmir KÃ¶fte", dessert: "KemalpaÅŸa TatlÄ±sÄ±", quote: "Sahur yemeÄŸi yiyin, zira sahurda bereket vardÄ±r.", source: "BuhÃ¢rÃ®, Savm 20" },
        { soup: "Domates Ã‡orbasÄ±", main: "Tas KebabÄ±", dessert: "KadayÄ±f", quote: "OruÃ§lu iken Ã§irkin sÃ¶z sÃ¶ylemeyin ve kimseyle Ã§ekiÅŸmeyin.", source: "BuhÃ¢rÃ®, Savm 9" },
        { soup: "Mantar Ã‡orbasÄ±", main: "HÃ¼nkÃ¢r BeÄŸendi", dessert: "Åekerpare", quote: "Cennette ReyyÃ¢n denilen bir kapÄ± vardÄ±r ki, kÄ±yamet gÃ¼nÃ¼ oradan ancak oruÃ§lular girecektir.", source: "BuhÃ¢rÃ®, Savm 4" },
        { soup: "DÃ¼ÄŸÃ¼n Ã‡orbasÄ±", main: "Etli Kuru Fasulye", dessert: "Supangle", quote: "Ramazan ayÄ± girdiÄŸinde cennet kapÄ±larÄ± aÃ§Ä±lÄ±r, cehennem kapÄ±larÄ± kapanÄ±r ve ÅŸeytanlar baÄŸlanÄ±r.", source: "BuhÃ¢rÃ®, Savm 5" },
        { soup: "Åehriye Ã‡orbasÄ±", main: "Tavuk Sote", dessert: "TrileÃ§e", quote: "Ä°nsanlarÄ±n en hayÄ±rlÄ±sÄ±, insanlara faydalÄ± olandÄ±r.", source: "Hadis-i Åerif" },
        { soup: "Brokoli Ã‡orbasÄ±", main: "FÄ±rÄ±n Somon", dessert: "Profiterol", quote: "KolaylaÅŸtÄ±rÄ±n, zorlaÅŸtÄ±rmayÄ±n; mÃ¼jdeleyin, nefret ettirmeyin.", source: "BuhÃ¢rÃ®, Ä°lim 11" },
        { soup: "Tavuk Suyu Ã‡orbasÄ±", main: "Alinazik", dessert: "TavukgÃ¶ÄŸsÃ¼", quote: "Veren el, alan elden Ã¼stÃ¼ndÃ¼r.", source: "MÃ¼slim, ZekÃ¢t 94" },
        { soup: "Kelle PaÃ§a Ã‡orbasÄ±", main: "Kavurma & Åehriyeli Pilav", dessert: "Baklava", quote: "MÃ¼slÃ¼manÄ±n MÃ¼slÃ¼mana tebessÃ¼m etmesi sadakadÄ±r.", source: "Tirmizi, Birr 36" },
        { soup: "Ayran AÅŸÄ± Ã‡orbasÄ±", main: "ZeytinyaÄŸlÄ± Taze Fasulye", dessert: "Kazandibi", quote: "Kim bir oruÃ§luya iftar ettirirse, oruÃ§lunun sevabÄ± kadar sevap kazanÄ±r.", source: "Tirmizi, Savm 82" },
        { soup: "Mahluta Ã‡orbasÄ±", main: "PatlÄ±can Musakka", dessert: "Cevizli Sarma", quote: "Sadaka, Rabbinin Ã¶fkesini sÃ¶ndÃ¼rÃ¼r ve kÃ¶tÃ¼ Ã¶lÃ¼mÃ¼ bertaraf eder.", source: "Tirmizi, ZekÃ¢t 28" },
        { soup: "Lebeniye Ã‡orbasÄ±", main: "KaÄŸÄ±t KebabÄ±", dessert: "Ä°rmik HelvasÄ±", quote: "Sizin en hayÄ±rlÄ±nÄ±z, Kur'an'Ä± Ã¶ÄŸrenen ve Ã¶ÄŸretendir.", source: "BuhÃ¢rÃ®, FezÃ¢ilÃ¼'l-Kur'Ã¢n 21" },
        { soup: "KremalÄ± Mantar Ã‡orbasÄ±", main: "FÄ±rÄ±n Makarna", dessert: "KÄ±brÄ±s TatlÄ±sÄ±", quote: "GÃ¼zel sÃ¶z sadakadÄ±r.", source: "BuhÃ¢rÃ®, Edeb 34" },
        { soup: "Yuvalama Ã‡orbasÄ±", main: "Kayseri Tava", dessert: "Lokma TatlÄ±sÄ±", quote: "Allah, merhametli olanlara merhamet eder.", source: "EbÃ» DÃ¢vÃ»d, Edeb 58" },
        { soup: "TutmaÃ§ Ã‡orbasÄ±", main: "Tavuklu Mantar Sote", dessert: "FÄ±rÄ±n SÃ¼tlaÃ§", quote: "Amellerin en hayÄ±rlÄ±sÄ±, az da olsa devamlÄ± olanÄ±dÄ±r.", source: "MÃ¼slim, MÃ¼sÃ¢firÃ®n 218" },
        { soup: "KÃ¶zlenmiÅŸ Domates Ã‡orbasÄ±", main: "HasanpaÅŸa KÃ¶fte", dessert: "ÅÃ¶biyet", quote: "Bir kimse kardeÅŸinin ihtiyacÄ±nÄ± giderirse, Allah da onun ihtiyacÄ±nÄ± giderir.", source: "BuhÃ¢rÃ®, MezÃ¢lim 3" },
        { soup: "Sebze Ã‡orbasÄ±", main: "Tepsi KebabÄ±", dessert: "KÃ¼nefe", quote: "SabÄ±r, imanÄ±n yarÄ±sÄ±dÄ±r.", source: "Hadis-i Åerif" },
        { soup: "Åafak Ã‡orbasÄ±", main: "Etli Nohut", dessert: "Muhallebi", quote: "HiÃ§biriniz kendi nefsi iÃ§in istediÄŸini kardeÅŸi iÃ§in de istemedikÃ§e tam mÃ¼min olamaz.", source: "BuhÃ¢rÃ®, ÃmÃ¢n 7" },
        { soup: "Ispanak Ã‡orbasÄ±", main: "ZeytinyaÄŸlÄ± Barbunya", dessert: "Zerde", quote: "OruÃ§, sabrÄ±n yarÄ±sÄ±dÄ±r.", source: "Ä°bn MÃ¢ce, SÄ±yÃ¢m 44" },
        { soup: "EriÅŸte Ã‡orbasÄ±", main: "Tavuk ÅiÅŸ", dessert: "Magnolia", quote: "Ä°ki nimet vardÄ±r ki, insanlarÄ±n Ã§oÄŸu bunlarÄ±n kÄ±ymetini bilmez: SaÄŸlÄ±k ve boÅŸ vakit.", source: "BuhÃ¢rÃ®, RikÃ¢k 1" },
        { soup: "Kabak Ã‡orbasÄ±", main: "KÃ¶fteli Patates Dizme", dessert: "ViÅŸneli Turta", quote: "Dua, ibadetin Ã¶zÃ¼dÃ¼r.", source: "Tirmizi, DaavÃ¢t 1" },
        { soup: "SoÄŸan Ã‡orbasÄ±", main: "Ã‡Ã¶kertme KebabÄ±", dessert: "SoÄŸuk Baklava", quote: "ÅÃ¼phesiz Allah, affedicidir ve affetmeyi sever.", source: "Tirmizi, DaavÃ¢t 84" },
        { soup: "MÄ±sÄ±r Ã‡orbasÄ±", main: "GÃ¼veÃ§te Et", dessert: "Krem Karamel", quote: "Kadir Gecesi'ni, faziletine inanarak ve sevabÄ±nÄ± umarak ihya edenin geÃ§miÅŸ gÃ¼nahlarÄ± baÄŸÄ±ÅŸlanÄ±r.", source: "BuhÃ¢rÃ®, Kadir 1" },
        { soup: "Bamya Ã‡orbasÄ±", main: "Misket KÃ¶fteli Bezelye", dessert: "Ä°ncir UyutmasÄ±", quote: "Kim Allah'a ve ahiret gÃ¼nÃ¼ne inanÄ±yorsa komÅŸusuna iyilik etsin.", source: "MÃ¼slim, ÃmÃ¢n 74" },
        { soup: "Tavuklu Åehriye Ã‡orbasÄ±", main: "Åehzade KebabÄ±", dessert: "Kelek TatlÄ±sÄ±", quote: "GerÃ§ek zenginlik mal Ã§okluÄŸu deÄŸil, gÃ¶nÃ¼l tokluÄŸudur.", source: "BuhÃ¢rÃ®, RikÃ¢k 15" },
        { soup: "Semizotu Ã‡orbasÄ±", main: "Eli BÃ¶ÄŸrÃ¼nde", dessert: "BÃ¼lbÃ¼l YuvasÄ±", quote: "Ä°ÅŸÃ§iye Ã¼cretini teri kurumadan veriniz.", source: "Ä°bn MÃ¢ce, RÃ¼hÃ»n 4" },
        { soup: "SÃ¼tlÃ¼ Kabak Ã‡orbasÄ±", main: "FÄ±rÄ±n PiliÃ§", dessert: "Saray SarmasÄ±", quote: "Bayram, gÃ¼nahlarÄ±n baÄŸÄ±ÅŸlandÄ±ÄŸÄ± gÃ¼ndÃ¼r.", source: "Hz. Ali (r.a.)" },
        { soup: "KÄ±rmÄ±zÄ± Mercimek Ã‡orbasÄ±", main: "KarÄ±ÅŸÄ±k Izgara", dessert: "Geleneksel GÃ¼llaÃ§", quote: "Ramazan'Ä±n sonu cehennemden azad olmaktÄ±r.", source: "Ä°bn Huzeyme" }
    ];

    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(e => console.log(e));
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
        }
    }

    document.addEventListener('fullscreenchange', () => {
        const fsBtn = document.getElementById('fsBtn');
        if (document.fullscreenElement) {
            fsBtn.innerHTML = "ğŸ”³ Ã‡Ä±kÄ±ÅŸ Yap";
        } else {
            fsBtn.innerHTML = "ğŸ”² Tam Ekran";
        }
    });

    function openModal() { document.getElementById('dailyModal').classList.add('active'); }
    function closeModal(event) {
        if(event && event.target !== document.getElementById('dailyModal') && event.target.className !== 'modal-close') return;
        document.getElementById('dailyModal').classList.remove('active');
    }

    function loadZikir() {
        zikirCount = parseInt(localStorage.getItem('imsakiye_zikir')) || 0;
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }
    function addZikir() {
        zikirCount++;
        localStorage.setItem('imsakiye_zikir', zikirCount);
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }
    function resetZikir() {
        zikirCount = 0;
        localStorage.setItem('imsakiye_zikir', zikirCount);
        document.getElementById('zikirDisplay').innerText = zikirCount;
    }

    function saveSettings() {
        const settings = {
            city: document.getElementById('citySelect').value,
            theme: document.getElementById('themeSelect').value,
            zoom: currentZoom,
            sound: document.getElementById('soundSelect').value,
            soundActive: document.getElementById('soundToggle').checked
        };
        localStorage.setItem('imsakiye_settings', JSON.stringify(settings));
    }

    function loadSettings() {
        const saved = localStorage.getItem('imsakiye_settings');
        if (saved) {
            const s = JSON.parse(saved);
            document.getElementById('citySelect').value = s.city || "Rize";
            document.getElementById('themeSelect').value = s.theme || "sepia";
            currentZoom = s.zoom || 0.95;
            document.getElementById('soundSelect').value = s.sound || "sound_bell";
            document.getElementById('soundToggle').checked = s.soundActive !== undefined ? s.soundActive : true;
        } else {
            document.getElementById('citySelect').value = "Rize";
            document.getElementById('themeSelect').value = "sepia";
        }
        changeTheme();
        document.getElementById('mainWrapper').style.zoom = currentZoom;
    }

    function changeZoom(s){ currentZoom+=s; document.getElementById('mainWrapper').style.zoom = currentZoom; saveSettings(); }
    function changeTheme(){ document.body.setAttribute('data-theme', document.getElementById('themeSelect').value); }
    
    function testSound() {
        const audio = document.getElementById(document.getElementById('soundSelect').value);
        if(audio) { audio.currentTime = 0; audio.play().catch(e => console.log("EtkileÅŸim gerekli")); }
    }

    const cities = ["Adana", "Adiyaman", "Afyonkarahisar", "Agri", "Aksaray", "Amasya", "Ankara", "Antalya", "Ardahan", "Artvin", "Aydin", "Balikesir", "Bartin", "Batman", "Bayburt", "Bilecik", "Bingol", "Bitlis", "Bolu", "Burdur", "Bursa", "Canakkale", "Cankiri", "Corum", "Denizli", "Diyarbakir", "Duzce", "Edirne", "Elazig", "Erzincan", "Erzurum", "Eskisehir", "Gaziantep", "Giresun", "Gumushane", "Hakkari", "Hatay", "Igdir", "Isparta", "Istanbul", "Izmir", "Kahramanmaras", "Karabuk", "Karaman", "Kars", "Kastamonu", "Kayseri", "Kilis", "Kirikkale", "Kirklareli", "Kirsehir", "Kocaeli", "Konya", "Kutahya", "Malatya", "Manisa", "Mardin", "Mersin", "Mugla", "Mus", "Nevsehir", "Nigde", "Ordu", "Osmaniye", "Rize", "Sakarya", "Samsun", "Sanliurfa", "Siirt", "Sinop", "Sirnak", "Sivas", "Tekirdag", "Tokat", "Trabzon", "Tunceli", "Usak", "Van", "Yalova", "Yozgat", "Zonguldak"];
    const citySelect = document.getElementById('citySelect');
    cities.forEach(c => { let o = document.createElement('option'); o.value = c; o.textContent = c; citySelect.appendChild(o); });

    function updateMoonPhase(hDay) {
        let phaseIndex = Math.floor((hDay / 29) * (moonPhases.length - 1));
        if(phaseIndex < 0) phaseIndex = 0; if(phaseIndex >= moonPhases.length) phaseIndex = moonPhases.length - 1;
        document.getElementById('moon').innerText = moonPhases[phaseIndex];
    }

    function updateDailyContent(hDay) {
        let index = hDay - 1;
        if(index < 0) index = 0;
        if(index >= ramadanContent.length) index = ramadanContent.length - 1;
        
        const data = ramadanContent[index];
        document.getElementById('modalTitle').innerHTML = `ğŸŒŸ ${hDay} Ramazan Ã–zel Ä°Ã§erikleri`;
        document.getElementById('menuSoup').innerText = data.soup;
        document.getElementById('menuMain').innerText = data.main;
        document.getElementById('menuDessert').innerText = data.dessert;
        document.getElementById('dailyQuote').innerText = `"${data.quote}"`;
        document.getElementById('dailySource').innerText = `- ${data.source}`;
    }

    function selectDay(el, h, im, gu, og, ik, ak, ya, isToday=false) {
        document.querySelectorAll('tr').forEach(tr => tr.classList.remove('selected-row'));
        if(el) el.classList.add('selected-row');
        
        window.isTodayView = isToday;
        document.getElementById('selectedDayTitle').innerText = isToday ? "ğŸ—“ï¸ BugÃ¼nÃ¼n Vakit Saatleri" : `ğŸ—“ï¸ ${h} Ramazan Vakit Saatleri`;
        
        updateMoonPhase(h);
        updateDailyContent(h);

        document.getElementById('todayTimesContainer').innerHTML = `
            <div class="time-row" data-time="${im}"><span>Ä°msak</span><span>${im}</span></div>
            <div class="time-row" data-time="${gu}"><span>GÃ¼neÅŸ</span><span>${gu}</span></div>
            <div class="time-row" data-time="${og}"><span>Ã–ÄŸle</span><span>${og}</span></div>
            <div class="time-row" data-time="${ik}"><span>Ä°kindi</span><span>${ik}</span></div>
            <div class="time-row iftar" data-time="${ak}"><span>Ä°ftar (AkÅŸam)</span><span>${ak}</span></div>
            <div class="time-row" data-time="${ya}"><span>YatsÄ±</span><span>${ya}</span></div>
        `;

        document.getElementById('modalTimesContainer').innerHTML = `
            <div class="modal-time-box"><div class="modal-time-name">Ä°msak</div><div class="modal-time-val">${im}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">GÃ¼neÅŸ</div><div class="modal-time-val">${gu}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">Ã–ÄŸle</div><div class="modal-time-val">${og}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">Ä°kindi</div><div class="modal-time-val">${ik}</div></div>
            <div class="modal-time-box iftar-box"><div class="modal-time-name">Ä°ftar</div><div class="modal-time-val">${ak}</div></div>
            <div class="modal-time-box"><div class="modal-time-name">YatsÄ±</div><div class="modal-time-val">${ya}</div></div>
        `;
        
        if(!isInitialLoad) {
            openModal();
        }
    }

    async function getMonthlyTimings() {
        const city = citySelect.value;
        const tbody1 = document.getElementById('tbody1'); const tbody2 = document.getElementById('tbody2');
        tbody1.innerHTML = ''; tbody2.innerHTML = ''; allEvents = [];
        try {
            const [rF, rM] = await Promise.all([
                fetch(`https://api.aladhan.com/v1/calendarByCity/2026/2?city=${city}&country=Turkey&method=13`),
                fetch(`https://api.aladhan.com/v1/calendarByCity/2026/3?city=${city}&country=Turkey&method=13`)
            ]);
            const dF = await rF.json(); const dM = await rM.json();
            const ramadanDays = [...dF.data, ...dM.data].filter(day => {
                const [d, m, y] = day.date.gregorian.date.split('-');
                const cur = new Date(`${y}-${m}-${d}`);
                return cur >= new Date('2026-02-19') && cur <= new Date('2026-03-19');
            });

            const todayStr = String(new Date().getDate()).padStart(2, '0') + '-' + String(new Date().getMonth() + 1).padStart(2, '0') + '-' + new Date().getFullYear();
            const mid = Math.ceil(ramadanDays.length / 2);
            let todayRef = null; let todayObj = null;

            ramadanDays.forEach((day, i) => {
                const t = day.timings; const gDate = day.date.gregorian.date; const hDay = i + 1;
                const clean = (s) => s.split(' ')[0];
                const v = { im: clean(t.Imsak), gu: clean(t.Sunrise), og: clean(t.Dhuhr), ik: clean(t.Asr), ak: clean(t.Maghrib), ya: clean(t.Isha) };
                const [d, m, y] = gDate.split('-');
                const makeD = (ts) => new Date(`${y}-${m}-${d}T${ts}:00`);
                
                // TÃœM VAKÄ°TLER LÄ°STEYE EKLENDÄ° (Ã–nceki sÃ¼rÃ¼mde sadece Ä°msak ve Ä°ftar vardÄ±)
                allEvents.push(
                    { n: 'Ä°msak', t: makeD(v.im), isFast: true },
                    { n: 'GÃ¼neÅŸ', t: makeD(v.gu), isFast: false },
                    { n: 'Ã–ÄŸle', t: makeD(v.og), isFast: false },
                    { n: 'Ä°kindi', t: makeD(v.ik), isFast: false },
                    { n: 'Ä°ftar', t: makeD(v.ak), isFast: true, isI: true },
                    { n: 'YatsÄ±', t: makeD(v.ya), isFast: false }
                );

                const isT = (gDate === todayStr);
                const row = document.createElement('tr');
                if(isT) row.className = 'today-row';
                
                row.onclick = () => selectDay(row, hDay, v.im, v.gu, v.og, v.ik, v.ak, v.ya, isT);
                row.innerHTML = `<td class="date-hicri">${hDay} Ramazan</td><td class="date-miladi">${d} ${["Oca","Åub","Mar","Nis","May","Haz","Tem","AÄŸu","Eyl","Eki","Kas","Ara"][m-1]}</td><td>${v.im}</td><td>${v.gu}</td><td>${v.og}</td><td>${v.ik}</td><td class="iftar-col">${v.ak}</td><td>${v.ya}</td>`;
                
                if(i < mid) tbody1.appendChild(row); else tbody2.appendChild(row);
                if(isT) { todayRef = row; todayObj = { hDay, ...v }; }
            });

            if(todayRef) todayRef.click();
            else if(ramadanDays.length > 0) tbody1.firstChild.click();
            
            isInitialLoad = false;

            startCountdown();
        } catch (e) { console.log(e); }
    }

   function startCountdown() {
        allEvents.sort((a,b) => a.t - b.t);
        clearInterval(countdownInterval);
        
        countdownInterval = setInterval(() => {
            const now = new Date(); 
            const futureEvents = allEvents.filter(e => e.t > now);
            const next = futureEvents[0]; // Mutlak sÄ±radaki vakit (Ã¶rn: Ã–ÄŸle)
            const nextFast = futureEvents.find(e => e.isFast); // SÄ±radaki oruÃ§ hedefi (Ä°ftar veya Ä°msak)
            
            // ANA SAYAÃ‡ EKRANI (Ä°ftar / Ä°msak)
            if(nextFast) {
                const diffFast = nextFast.t - now;
                const hF = Math.floor(diffFast / 3600000); 
                const mF = Math.floor((diffFast % 3600000) / 60000); 
                const sF = Math.floor((diffFast % 60000) / 1000);
                const pad = (n) => String(n).padStart(2, '0');
                
                document.getElementById('mainCountdownTitle').innerText = `${nextFast.n} Vaktine Kalan`;
                document.getElementById('mainCountdownTimer').innerText = `${pad(hF)}:${pad(mF)}:${pad(sF)}`;
                document.getElementById('mainCountdownTitle').style.color = nextFast.isI ? 'var(--iftar-color)' : 'var(--accent)';
            }

            // TÃœM VAKÄ°TLER Ä°Ã‡Ä°N KONTROLLER (15 Dk UyarÄ±sÄ± ve Tam Saat Sesi)
            if (next) {
                const diffNext = next.t - now;
                const hN = Math.floor(diffNext / 3600000); 
                const mN = Math.floor((diffNext % 3600000) / 60000); 
                const sN = Math.floor((diffNext % 60000) / 1000);
                const pad = (n) => String(n).padStart(2, '0');

                // Ara SayaÃ§ (Ã–ÄŸle, Ä°kindi, YatsÄ± vb.) GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼
                if (nextFast && next.n !== nextFast.n) {
                    document.getElementById('subCountdownContainer').style.display = 'block';
                    document.getElementById('subCountdownTitle').innerText = `SÄ±radaki Vakit (${next.n})`;
                    document.getElementById('subCountdownTimer').innerText = `${pad(hN)}:${pad(mN)}:${pad(sN)}`;
                } else {
                    document.getElementById('subCountdownContainer').style.display = 'none';
                }

                // --- YENÄ°: 15 DAKÄ°KA UYARISI (TÃœM VAKÄ°TLER Ä°Ã‡Ä°N) ---
                if (diffNext <= 900000) { // 15 dakika veya daha az kaldÄ±ysa
                    
                    // Hangi sayacÄ±n yanÄ±p sÃ¶neceÄŸini belirle (GÃ¶rsel UyarÄ±)
                    if (nextFast && next.n === nextFast.n) {
                        document.getElementById('mainCountdownTimer').classList.add('warning-15');
                        document.getElementById('subCountdownTimer').classList.remove('warning-15');
                    } else {
                        document.getElementById('subCountdownTimer').classList.add('warning-15');
                        document.getElementById('mainCountdownTimer').classList.remove('warning-15');
                    }

                    // Sadece tam 15:00'da 1 kere uyarÄ± sesi Ã§al
                    if (mN === 15 && sN === 0 && !warningPlayed && document.getElementById('soundToggle').checked) {
                        document.getElementById('sound_warning').play().catch(e => console.log("Ses oynatma engellendi:", e));
                        warningPlayed = true;
                    }
                } else {
                    // 15 dakikadan fazla varsa gÃ¶rsel uyarÄ±larÄ± kaldÄ±r
                    document.getElementById('mainCountdownTimer').classList.remove('warning-15');
                    document.getElementById('subCountdownTimer').classList.remove('warning-15');
                    warningPlayed = false; // BayraÄŸÄ± sÄ±fÄ±rla
                }

                // --- YENÄ°: TAM SAATÄ°NDE ZÄ°L Ã‡ALMA (TÃœM VAKÄ°TLER Ä°Ã‡Ä°N) ---
                if(hN === 0 && mN === 0 && sN === 0 && document.getElementById('soundToggle').checked) {
                    const selectedSound = document.getElementById('soundSelect').value;
                    document.getElementById(selectedSound).play().catch(e => console.log("Ses oynatma engellendi:", e));
                }
            }

            // GÃœNLÃœK VAKÄ°TLER ÃœZERÄ°NDE GEÃ‡MÄ°Å ZAMANLARI SOLUKLAÅTIRMA
            if (window.isTodayView) {
                document.querySelectorAll('#todayTimesContainer .time-row').forEach(row => {
                    const timeStr = row.getAttribute('data-time');
                    if(timeStr) {
                        const [hr, mn] = timeStr.split(':');
                        const rowTime = new Date();
                        rowTime.setHours(hr, mn, 0, 0);
                        if (now >= rowTime) row.classList.add('past-time');
                        else row.classList.remove('past-time');
                    }
                });
            } else {
                document.querySelectorAll('#todayTimesContainer .time-row').forEach(r => r.classList.remove('past-time'));
            }

            // ORUÃ‡ Ä°LERLEME Ã‡UBUÄU (BAR)
            const pastEvents = allEvents.filter(e => e.t <= now);
            let nextIftar = futureEvents.find(e => e.isI === true);
            let prevImsak = pastEvents.slice().reverse().find(e => e.n === 'Ä°msak');

            if (nextIftar && prevImsak && nextIftar.t.getDate() === prevImsak.t.getDate()) {
                let totalTime = nextIftar.t - prevImsak.t;
                let elapsedTime = now - prevImsak.t;
                let percentage = (elapsedTime / totalTime) * 100;
                
                document.getElementById('progressContainer').style.display = 'block';
                document.getElementById('progressBar').style.width = percentage + '%';
                document.getElementById('progressText').innerText = `OruÃ§ Ä°lerlemesi: %${percentage.toFixed(1)}`;
            } else {
                document.getElementById('progressContainer').style.display = 'none';
            }

        }, 1000);
    }

    function updateLiveDateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('liveTime').innerText = `${hours}:${minutes}:${seconds}`;
        
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        document.getElementById('liveDate').innerText = now.toLocaleDateString('tr-TR', options) + " (Miladi)";
    }

   window.onload = () => {
        loadSettings();
        loadZikir();
        getMonthlyTimings();
        
        updateLiveDateTime();
        setInterval(updateLiveDateTime, 1000);
    };

    // PWA Service Worker Kodunu buraya, mevcut script'in iÃ§ine aldÄ±k.
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('PWA Service Worker baÅŸarÄ±yla kaydedildi.', reg))
                .catch(err => console.log('PWA Service Worker hatasÄ±:', err));
        });
    }
// UYGULAMAYI YÃœKLE (PWA) BUTONU MANTIÄI
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        // TarayÄ±cÄ±nÄ±n varsayÄ±lan uyarÄ± Ã§ubuÄŸunu engelle
        e.preventDefault();
        // OlayÄ± daha sonra butona basÄ±ldÄ±ÄŸÄ±nda kullanmak iÃ§in kaydet
        deferredPrompt = e;
        // Gizli olan 'UygulamayÄ± YÃ¼kle' butonumuzu gÃ¶rÃ¼nÃ¼r yap
        document.getElementById('installAppBtn').style.display = 'block';
    });

    document.getElementById('installAppBtn').addEventListener('click', async () => {
        if (deferredPrompt) {
            // YÃ¼kleme penceresini gÃ¶ster
            deferredPrompt.prompt();
            // KullanÄ±cÄ±nÄ±n cevabÄ±nÄ± bekle
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                console.log('KullanÄ±cÄ± uygulamayÄ± yÃ¼kledi.');
                document.getElementById('installAppBtn').style.display = 'none';
            }
            deferredPrompt = null;
        }
    });
</script>
</body>
</html>